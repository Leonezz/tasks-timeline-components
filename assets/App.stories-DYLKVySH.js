import{j as u}from"./jsx-runtime-u17CrQMm.js";import{r as E}from"./iframe-KW6RtBM2.js";import{T as Rt}from"./TodoList-ClKDqDTT.js";import{I as Ft}from"./InputBar-DzT_0tk_.js";import{S as Ut}from"./SettingsModal-N-ELjEGi.js";import{T as jt}from"./TaskEditModal-V__ARYRI.js";import{T as Pt}from"./Toast-CFTm_6na.js";import{T as A,G as Bt,c as ne}from"./index-goBt61iM.js";import{d as ot}from"./BacklogSection-l2CyhjOv.js";import{l as T}from"./logger-CDMKXnH4.js";import{I as Re}from"./Icon-CFZCLKt0.js";import{A as qt}from"./AppContext-CgiYEWF5.js";import{T as _t,S as Gt}from"./SettingsContext-CelCWxaL.js";import{M as ft}from"./Motion-DxXHqm4t.js";import{A as Lt}from"./index-6uNkXKNh.js";import{w as Q,d as H}from"./test-utils-BNouzmjp.js";import{t as Vt}from"./tasks-BV5_RF93.js";import"./preload-helper-PPVm8Dsz.js";import"./YearSection-CX2lh9KF.js";import"./DaySection-C_XPnI8d.js";import"./TaskItem-Di_rPK8a.js";import"./DateBadge-Calkfi_n.js";import"./popover-DUPQEFUd.js";import"./index-CuxhDgIS.js";import"./index-BH6JDbuJ.js";import"./calendar-BTs5a-KE.js";import"./TagBadge-BQ24vSMj.js";import"./PriorityPopover-Jsbhv-3h.js";import"./CategoryPopover-Bezj7DBe.js";import"./useVoiceInput-BWfKLRX-.js";import"./collapsible-h46-68d_.js";import"./proxy-B9VYbwnC.js";import"./SettingsPage-B6p2kvc_.js";import"./SettingsPageGeneral-oSBRawF8.js";import"./SettingsPageAdvanced-CDZJF22k.js";import"./index-CuGcjXI2.js";const $t=E.createContext(null),Ve={didCatch:!1,error:null};class $e extends E.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Ve}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(...t){const{error:s}=this.state;s!==null&&(this.props.onReset?.({args:t,reason:"imperative-api"}),this.setState(Ve))}componentDidCatch(t,s){this.props.onError?.(t,s)}componentDidUpdate(t,s){const{didCatch:n}=this.state,{resetKeys:a}=this.props;n&&s.error!==null&&Kt(t.resetKeys,a)&&(this.props.onReset?.({next:a,prev:t.resetKeys,reason:"keys"}),this.setState(Ve))}render(){const{children:t,fallbackRender:s,FallbackComponent:n,fallback:a}=this.props,{didCatch:l,error:r}=this.state;let i=t;if(l){const d={error:r,resetErrorBoundary:this.resetErrorBoundary};if(typeof s=="function")i=s(d);else if(n)i=E.createElement(n,d);else if(a!==void 0)i=a;else throw r}return E.createElement($t.Provider,{value:{didCatch:l,error:r,resetErrorBoundary:this.resetErrorBoundary}},i)}}function Kt(e=[],t=[]){return e.length!==t.length||e.some((s,n)=>!Object.is(s,t[n]))}const Yt=()=>[{name:"create_task",description:"Creates a new task with given properties.",parameters:{type:A.OBJECT,properties:{title:{type:A.STRING,description:"The title of the task."},description:{type:A.STRING,description:"Additional details about the task."},priority:{type:A.STRING,description:"Task priority: low, medium, or high.",enum:["low","medium","high"]},dueAt:{type:A.STRING,description:"ISO 8601 date string (YYYY-MM-DD)."},category:{type:A.STRING,description:"The organizational category."},tags:{type:A.ARRAY,items:{type:A.STRING},description:"A list of tag names."}},required:["title"]}},{name:"query_tasks",description:"Queries existing tasks based on filters.",parameters:{type:A.OBJECT,properties:{status:{type:A.STRING,description:"Filter by task status.",enum:["done","scheduled","todo","due","overdue","cancelled","unplanned","doing"]},date:{type:A.STRING,description:"Filter by date (YYYY-MM-DD)."},search:{type:A.STRING,description:"Search term for task title."}}}},{name:"update_task",description:"Updates properties of an existing task.",parameters:{type:A.OBJECT,properties:{id:{type:A.STRING,description:"The unique ID of the task to update."},title:{type:A.STRING},description:{type:A.STRING},status:{type:A.STRING,enum:["done","scheduled","todo","due","overdue","cancelled","unplanned","doing"]},priority:{type:A.STRING,enum:["low","medium","high"]},dueAt:{type:A.STRING},category:{type:A.STRING},tags:{type:A.ARRAY,items:{type:A.STRING}}},required:["id"]}},{name:"delete_task",description:"Deletes a task by its ID.",parameters:{type:A.OBJECT,properties:{id:{type:A.STRING,description:"The ID of the task to delete."}},required:["id"]}}];class Wt{name="Local Browser Settings";settingsKey="tasks_timeline_settings_data";settingsSaveTimeout=null;async loadSettings(){const t=localStorage.getItem(this.settingsKey);if(!t)return null;try{const s=JSON.parse(t);return T.debug("Storage","Loaded settings from local storage."),s}catch(s){return T.error("Storage","Failed to parse settings",s),null}}async saveSettings(t){return this.settingsSaveTimeout&&window.clearTimeout(this.settingsSaveTimeout),new Promise(s=>{this.settingsSaveTimeout=window.setTimeout(()=>{try{localStorage.setItem(this.settingsKey,JSON.stringify(t)),T.debug("Storage","Persisted settings."),this.settingsSaveTimeout=null,s()}catch(n){T.error("Storage","Failed to save settings",n),s()}},500)})}}const We=e=>e instanceof Error?e.message:typeof e=="string"?e:"An unknown error occurred",mt=({error:e,resetErrorBoundary:t})=>u.jsxs(ft,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-8 text-center space-y-4 max-w-md mx-auto",children:[u.jsx("div",{className:"text-rose-500 flex justify-center",children:u.jsx(Re,{name:"AlertTriangle",size:48})}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-lg text-slate-900",children:"Something went wrong"}),u.jsx("p",{className:"text-sm text-slate-600 mt-2 font-mono bg-slate-50 p-3 rounded border border-slate-200",children:We(e)})]}),u.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:"Try Again"})]}),gt=({error:e,resetErrorBoundary:t})=>u.jsx(ft,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"p-4 bg-rose-50 border border-rose-200 rounded-lg mx-4 mb-4",children:u.jsxs("div",{className:"flex items-start gap-3",children:[u.jsx("div",{className:"text-rose-600 mt-0.5",children:u.jsx(Re,{name:"AlertCircle",size:20})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"font-semibold text-rose-900 text-sm",children:"AI Command Failed"}),u.jsx("p",{className:"text-sm text-rose-700 mt-1",children:We(e)}),u.jsx("button",{onClick:t,className:"text-xs text-rose-600 underline mt-2 hover:text-rose-800",children:"Dismiss"})]})]})}),kt=({error:e,resetErrorBoundary:t})=>u.jsxs("div",{className:"p-6 text-center space-y-4",children:[u.jsx("div",{className:"text-rose-500 flex justify-center",children:u.jsx(Re,{name:"XCircle",size:40})}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-bold text-base text-slate-900",children:"Failed to load modal"}),u.jsx("p",{className:"text-xs text-slate-600 mt-2 font-mono bg-slate-50 p-2 rounded border border-slate-200",children:We(e)})]}),u.jsx("button",{onClick:t,className:"px-3 py-1.5 text-sm bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors",children:"Close"})]});mt.__docgenInfo={description:"",methods:[],displayName:"TaskListErrorFallback"};gt.__docgenInfo={description:"",methods:[],displayName:"AIErrorFallback"};kt.__docgenInfo={description:"",methods:[],displayName:"ModalErrorFallback"};var B="INUMBER",le="IOP1",ue="IOP2",de="IOP3",$="IVAR",X="IVARNAME",re="IFUNCALL",Fe="IFUNDEF",F="IEXPR",ze="IEXPREVAL",Z="IMEMBER",Ue="IENDSTATEMENT",oe="IARRAY";function y(e,t){this.type=e,this.value=t??0}y.prototype.toString=function(){switch(this.type){case B:case le:case ue:case de:case $:case X:case Ue:return this.value;case re:return"CALL "+this.value;case Fe:return"DEF "+this.value;case oe:return"ARRAY "+this.value;case Z:return"."+this.value;default:return"Invalid Instruction"}};function je(e){return new y(le,e)}function Y(e){return new y(ue,e)}function Tt(e){return new y(de,e)}function Ye(e,t,s,n,a){for(var l=[],r=[],i,d,c,f,h=0;h<e.length;h++){var o=e[h],m=o.type;if(m===B||m===X)Array.isArray(o.value)?l.push.apply(l,Ye(o.value.map(function(k){return new y(B,k)}).concat(new y(oe,o.value.length)),t,s,n,a)):l.push(o);else if(m===$&&a.hasOwnProperty(o.value))o=new y(B,a[o.value]),l.push(o);else if(m===ue&&l.length>1)d=l.pop(),i=l.pop(),f=s[o.value],o=new y(B,f(i.value,d.value)),l.push(o);else if(m===de&&l.length>2)c=l.pop(),d=l.pop(),i=l.pop(),o.value==="?"?l.push(i.value?d.value:c.value):(f=n[o.value],o=new y(B,f(i.value,d.value,c.value)),l.push(o));else if(m===le&&l.length>0)i=l.pop(),f=t[o.value],o=new y(B,f(i.value)),l.push(o);else if(m===F){for(;l.length>0;)r.push(l.shift());r.push(new y(F,Ye(o.value,t,s,n,a)))}else if(m===Z&&l.length>0)i=l.pop(),l.push(new y(B,i.value[o.value]));else{for(;l.length>0;)r.push(l.shift());r.push(o)}}for(;l.length>0;)r.push(l.shift());return r}function yt(e,t,s){for(var n=[],a=0;a<e.length;a++){var l=e[a],r=l.type;if(r===$&&l.value===t)for(var i=0;i<s.tokens.length;i++){var d=s.tokens[i],c;d.type===le?c=je(d.value):d.type===ue?c=Y(d.value):d.type===de?c=Tt(d.value):c=new y(d.type,d.value),n.push(c)}else r===F?n.push(new y(F,yt(l.value,t,s))):n.push(l)}return n}function J(e,t,s){var n=[],a,l,r,i,d,c;if(Je(e))return V(e,s);for(var f=e.length,h=0;h<f;h++){var o=e[h],m=o.type;if(m===B||m===X)n.push(o.value);else if(m===ue)l=n.pop(),a=n.pop(),o.value==="and"?n.push(a?!!J(l,t,s):!1):o.value==="or"?n.push(a?!0:!!J(l,t,s)):o.value==="="?(i=t.binaryOps[o.value],n.push(i(a,J(l,t,s),s))):(i=t.binaryOps[o.value],n.push(i(V(a,s),V(l,s))));else if(m===de)r=n.pop(),l=n.pop(),a=n.pop(),o.value==="?"?n.push(J(a?l:r,t,s)):(i=t.ternaryOps[o.value],n.push(i(V(a,s),V(l,s),V(r,s))));else if(m===$)if(o.value in t.functions)n.push(t.functions[o.value]);else if(o.value in t.unaryOps&&t.parser.isOperatorEnabled(o.value))n.push(t.unaryOps[o.value]);else{var k=s[o.value];if(k!==void 0)n.push(k);else throw new Error("undefined variable: "+o.value)}else if(m===le)a=n.pop(),i=t.unaryOps[o.value],n.push(i(V(a,s)));else if(m===re){for(c=o.value,d=[];c-- >0;)d.unshift(V(n.pop(),s));if(i=n.pop(),i.apply&&i.call)n.push(i.apply(void 0,d));else throw new Error(i+" is not a function")}else if(m===Fe)n.push((function(){for(var w=n.pop(),S=[],P=o.value;P-- >0;)S.unshift(n.pop());var M=n.pop(),I=function(){for(var j=Object.assign({},s),G=0,he=S.length;G<he;G++)j[S[G]]=arguments[G];return J(w,t,j)};return Object.defineProperty(I,"name",{value:M,writable:!1}),s[M]=I,I})());else if(m===F)n.push(zt(o,t));else if(m===ze)n.push(o);else if(m===Z)a=n.pop(),n.push(a[o.value]);else if(m===Ue)n.pop();else if(m===oe){for(c=o.value,d=[];c-- >0;)d.unshift(n.pop());n.push(d)}else throw new Error("invalid Expression")}if(n.length>1)throw new Error("invalid Expression (parity)");return n[0]===0?0:V(n[0],s)}function zt(e,t,s){return Je(e)?e:{type:ze,value:function(n){return J(e.value,t,n)}}}function Je(e){return e&&e.type===ze}function V(e,t){return Je(e)?e.value(t):e}function Xe(e,t){for(var s=[],n,a,l,r,i,d,c=0;c<e.length;c++){var f=e[c],h=f.type;if(h===B)typeof f.value=="number"&&f.value<0?s.push("("+f.value+")"):Array.isArray(f.value)?s.push("["+f.value.map(it).join(", ")+"]"):s.push(it(f.value));else if(h===ue)a=s.pop(),n=s.pop(),r=f.value,t?r==="^"?s.push("Math.pow("+n+", "+a+")"):r==="and"?s.push("(!!"+n+" && !!"+a+")"):r==="or"?s.push("(!!"+n+" || !!"+a+")"):r==="||"?s.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+n+"),("+a+")))"):r==="=="?s.push("("+n+" === "+a+")"):r==="!="?s.push("("+n+" !== "+a+")"):r==="["?s.push(n+"[("+a+") | 0]"):s.push("("+n+" "+r+" "+a+")"):r==="["?s.push(n+"["+a+"]"):s.push("("+n+" "+r+" "+a+")");else if(h===de)if(l=s.pop(),a=s.pop(),n=s.pop(),r=f.value,r==="?")s.push("("+n+" ? "+a+" : "+l+")");else throw new Error("invalid Expression");else if(h===$||h===X)s.push(f.value);else if(h===le)n=s.pop(),r=f.value,r==="-"||r==="+"?s.push("("+r+n+")"):t?r==="not"?s.push("(!"+n+")"):r==="!"?s.push("fac("+n+")"):s.push(r+"("+n+")"):r==="!"?s.push("("+n+"!)"):s.push("("+r+" "+n+")");else if(h===re){for(d=f.value,i=[];d-- >0;)i.unshift(s.pop());r=s.pop(),s.push(r+"("+i.join(", ")+")")}else if(h===Fe){for(a=s.pop(),d=f.value,i=[];d-- >0;)i.unshift(s.pop());n=s.pop(),t?s.push("("+n+" = function("+i.join(", ")+") { return "+a+" })"):s.push("("+n+"("+i.join(", ")+") = "+a+")")}else if(h===Z)n=s.pop(),s.push(n+"."+f.value);else if(h===oe){for(d=f.value,i=[];d-- >0;)i.unshift(s.pop());s.push("["+i.join(", ")+"]")}else if(h===F)s.push("("+Xe(f.value,t)+")");else if(h!==Ue)throw new Error("invalid Expression")}return s.length>1&&(t?s=[s.join(",")]:s=[s.join(";")]),String(s[0])}function it(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function ae(e,t){for(var s=0;s<e.length;s++)if(e[s]===t)return!0;return!1}function Qe(e,t,s){s=s||{};for(var n=!!s.withMembers,a=null,l=0;l<e.length;l++){var r=e[l];r.type===$||r.type===X?!n&&!ae(t,r.value)?t.push(r.value):(a!==null&&(ae(t,a)||t.push(a)),a=r.value):r.type===Z&&n&&a!==null?a+="."+r.value:r.type===F?Qe(r.value,t,s):a!==null&&(ae(t,a)||t.push(a),a=null)}a!==null&&!ae(t,a)&&t.push(a)}function _(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}_.prototype.simplify=function(e){return e=e||{},new _(Ye(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)};_.prototype.substitute=function(e,t){return t instanceof _||(t=this.parser.parse(String(t))),new _(yt(this.tokens,e,t),this.parser)};_.prototype.evaluate=function(e){return e=e||{},J(this.tokens,this,e)};_.prototype.toString=function(){return Xe(this.tokens,!1)};_.prototype.symbols=function(e){e=e||{};var t=[];return Qe(this.tokens,t,e),t};_.prototype.variables=function(e){e=e||{};var t=[];Qe(this.tokens,t,e);var s=this.functions;return t.filter(function(n){return!(n in s)})};_.prototype.toJSFunction=function(e,t){var s=this,n=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+Xe(this.simplify(t).tokens,!0)+"; }");return function(){return n.apply(s,arguments)}};var ce="TEOF",x="TOP",Pe="TNUMBER",vt="TSTRING",K="TPAREN",ie="TBRACKET",Be="TCOMMA",He="TNAME",Ze="TSEMICOLON";function wt(e,t,s){this.type=e,this.value=t,this.index=s}wt.prototype.toString=function(){return this.type+": "+this.value};function C(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}C.prototype.newToken=function(e,t,s){return new wt(e,t,s??this.pos)};C.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};C.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};C.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(ce,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};C.prototype.isString=function(){var e=!1,t=this.pos,s=this.expression.charAt(t);if(s==="'"||s==='"')for(var n=this.expression.indexOf(s,t+1);n>=0&&this.pos<this.expression.length;){if(this.pos=n+1,this.expression.charAt(n-1)!=="\\"){var a=this.expression.substring(t+1,n);this.current=this.newToken(vt,this.unescape(a),t),e=!0;break}n=this.expression.indexOf(s,n+1)}return e};C.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(K,e),this.pos++,!0):!1};C.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(ie,e),this.pos++,!0):!1};C.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(Be,","),this.pos++,!0):!1};C.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(Ze,";"),this.pos++,!0):!1};C.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()&&(t===this.pos||s!=="_"&&s!=="."&&(s<"0"||s>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(n in this.consts)return this.current=this.newToken(Pe,this.consts[n]),this.pos+=n.length,!0}return!1};C.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()&&(t===this.pos||s!=="_"&&(s<"0"||s>"9")))break}if(t>e){var n=this.expression.substring(e,t);if(this.isOperatorEnabled(n)&&(n in this.binaryOps||n in this.unaryOps||n in this.ternaryOps))return this.current=this.newToken(x,n),this.pos+=n.length,!0}return!1};C.prototype.isName=function(){for(var e=this.pos,t=e,s=!1;t<this.expression.length;t++){var n=this.expression.charAt(t);if(n.toUpperCase()===n.toLowerCase()){if(t===this.pos&&(n==="$"||n==="_")){n==="_"&&(s=!0);continue}else if(t===this.pos||!s||n!=="_"&&(n<"0"||n>"9"))break}else s=!0}if(s){var a=this.expression.substring(e,t);return this.current=this.newToken(He,a),this.pos+=a.length,!0}return!1};C.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var Jt=/^[0-9a-f]{4}$/i;C.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var s=e.substring(0,t);t>=0;){var n=e.charAt(++t);switch(n){case"'":s+="'";break;case'"':s+='"';break;case"\\":s+="\\";break;case"/":s+="/";break;case"b":s+="\b";break;case"f":s+="\f";break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"u":var a=e.substring(t+1,t+5);Jt.test(a)||this.parseError("Illegal escape sequence: \\u"+a),s+=String.fromCharCode(parseInt(a,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+n+'"')}++t;var l=e.indexOf("\\",t);s+=e.substring(t,l<0?e.length:l),t=l}return s};C.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};C.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,s;if(this.expression.charAt(e)==="x")t=16,s=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,s=/^[01]$/i,++e;else return!1;for(var n=!1,a=e;e<this.expression.length;){var l=this.expression.charAt(e);if(s.test(l))e++,n=!0;else break}return n&&(this.current=this.newToken(Pe,parseInt(this.expression.substring(a,e),t)),this.pos=e),n};C.prototype.isNumber=function(){for(var e=!1,t=this.pos,s=t,n=t,a=!1,l=!1,r;t<this.expression.length&&(r=this.expression.charAt(t),r>="0"&&r<="9"||!a&&r===".");)r==="."?a=!0:l=!0,t++,e=l;if(e&&(n=t),r==="e"||r==="E"){t++;for(var i=!0,d=!1;t<this.expression.length;){if(r=this.expression.charAt(t),i&&(r==="+"||r==="-"))i=!1;else if(r>="0"&&r<="9")d=!0,i=!1;else break;t++}d||(t=n)}return e?(this.current=this.newToken(Pe,parseFloat(this.expression.substring(s,t))),this.pos=t):this.pos=n,e};C.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(x,t);else if(t==="∙"||t==="•")this.current=this.newToken(x,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(x,">="),this.pos++):this.current=this.newToken(x,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(x,"<="),this.pos++):this.current=this.newToken(x,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(x,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(x,"=="),this.pos++):this.current=this.newToken(x,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(x,"!="),this.pos++):this.current=this.newToken(x,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)};C.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)};C.prototype.getCoordinates=function(){var e=0,t,s=-1;do e++,t=this.pos-s,s=this.expression.indexOf(`
`,s+1);while(s>=0&&s<this.pos);return{line:e,column:t}};C.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function b(e,t,s){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=s.allowMemberAccess!==!1}b.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};b.prototype.tokenMatches=function(e,t){return typeof t>"u"?!0:Array.isArray(t)?ae(t,e.value):typeof t=="function"?t(e):e.value===t};b.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};b.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};b.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1};b.prototype.expect=function(e,t){if(!this.accept(e,t)){var s=this.tokens.getCoordinates();throw new Error("parse error ["+s.line+":"+s.column+"]: Expected "+(t||e))}};b.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function s(a){return a.value in t}if(this.accept(He)||this.accept(x,s))e.push(new y($,this.current.value));else if(this.accept(Pe))e.push(new y(B,this.current.value));else if(this.accept(vt))e.push(new y(B,this.current.value));else if(this.accept(K,"("))this.parseExpression(e),this.expect(K,")");else if(this.accept(ie,"["))if(this.accept(ie,"]"))e.push(new y(oe,0));else{var n=this.parseArrayList(e);e.push(new y(oe,n))}else throw new Error("unexpected "+this.nextToken)};b.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))};b.prototype.pushExpression=function(e,t){for(var s=0,n=t.length;s<n;s++)e.push(t[s])};b.prototype.parseUntilEndStatement=function(e,t){return this.accept(Ze)?(this.nextToken&&this.nextToken.type!==ce&&!(this.nextToken.type===K&&this.nextToken.value===")")&&t.push(new y(Ue)),this.nextToken.type!==ce&&this.parseExpression(t),e.push(new y(F,t)),!0):!1};b.prototype.parseArrayList=function(e){for(var t=0;!this.accept(ie,"]");)for(this.parseExpression(e),++t;this.accept(Be);)this.parseExpression(e),++t;return t};b.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(x,"=");){var t=e.pop(),s=[],n=e.length-1;if(t.type===re){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var a=0,l=t.value+1;a<l;a++){var r=n-a;e[r].type===$&&(e[r]=new y(X,e[r].value))}this.parseVariableAssignmentExpression(s),e.push(new y(F,s)),e.push(new y(Fe,t.value));continue}if(t.type!==$&&t.type!==Z)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(s),e.push(new y(X,t.value)),e.push(new y(F,s)),e.push(Y("="))}};b.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(x,"?");){var t=[],s=[];this.parseConditionalExpression(t),this.expect(x,":"),this.parseConditionalExpression(s),e.push(new y(F,t)),e.push(new y(F,s)),e.push(Tt("?"))}};b.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(x,"or");){var t=[];this.parseAndExpression(t),e.push(new y(F,t)),e.push(Y("or"))}};b.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(x,"and");){var t=[];this.parseComparison(t),e.push(new y(F,t)),e.push(Y("and"))}};var Xt=["==","!=","<","<=",">=",">","in"];b.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(x,Xt);){var t=this.current;this.parseAddSub(e),e.push(Y(t.value))}};var Qt=["+","-","||"];b.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(x,Qt);){var t=this.current;this.parseTerm(e),e.push(Y(t.value))}};var Ht=["*","/","%"];b.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(x,Ht);){var t=this.current;this.parseFactor(e),e.push(Y(t.value))}};b.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function s(a){return a.value in t}if(this.save(),this.accept(x,s)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===K&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===Ze||this.nextToken.type===Be||this.nextToken.type===ce||this.nextToken.type===K&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var n=this.current;this.parseFactor(e),e.push(je(n.value))}else this.parseExponential(e)};b.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(x,"^");)this.parseFactor(e),e.push(Y("^"))};b.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(x,"!");)e.push(je("!"))};b.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function s(l){return l.value in t}if(this.accept(x,s)){var n=this.current;this.parseAtom(e),e.push(je(n.value))}else for(this.parseMemberExpression(e);this.accept(K,"(");)if(this.accept(K,")"))e.push(new y(re,0));else{var a=this.parseArgumentList(e);e.push(new y(re,a))}};b.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(K,")");)for(this.parseExpression(e),++t;this.accept(Be);)this.parseExpression(e),++t;return t};b.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(x,".")||this.accept(ie,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(He),e.push(new y(Z,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(ie,"]"),e.push(Y("["))}else throw new Error("unexpected symbol: "+t.value)}};function Zt(e,t){return Number(e)+Number(t)}function es(e,t){return e-t}function ts(e,t){return e*t}function ss(e,t){return e/t}function ns(e,t){return e%t}function as(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function rs(e,t){return e===t}function os(e,t){return e!==t}function is(e,t){return e>t}function ls(e,t){return e<t}function us(e,t){return e>=t}function ds(e,t){return e<=t}function ps(e,t){return!!(e&&t)}function cs(e,t){return!!(e||t)}function hs(e,t){return ae(t,e)}function fs(e){return(Math.exp(e)-Math.exp(-e))/2}function ms(e){return(Math.exp(e)+Math.exp(-e))/2}function gs(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function ks(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function Ts(e){return Math.log(e+Math.sqrt(e*e-1))}function ys(e){return Math.log((1+e)/(1-e))/2}function lt(e){return Math.log(e)*Math.LOG10E}function vs(e){return-e}function ws(e){return!e}function xs(e){return e<0?Math.ceil(e):Math.floor(e)}function bs(e){return Math.random()*(e||1)}function ut(e){return et(e+1)}function As(e){return isFinite(e)&&e===Math.round(e)}var Es=4.7421875,Ke=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function et(e){var t,s;if(As(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var n=e-2,a=e-1;n>1;)a*=n,n--;return a===0&&(a=1),a}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*et(1-e));if(e>=171.35)return 1/0;if(e>85){var l=e*e,r=l*e,i=r*e,d=i*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*l)-139/(51840*r)-571/(2488320*i)+163879/(209018880*d)+5246819/(75246796800*d*e))}--e,s=Ke[0];for(var c=1;c<Ke.length;++c)s+=Ke[c]/(e+c);return t=e+Es+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*s}function Cs(e){return Array.isArray(e)?e.length:String(e).length}function dt(){for(var e=0,t=0,s=0;s<arguments.length;s++){var n=Math.abs(arguments[s]),a;t<n?(a=t/n,e=e*a*a+1,t=n):n>0?(a=n/t,e+=a*a):e+=n}return t===1/0?1/0:t*Math.sqrt(e)}function pt(e,t,s){return e?t:s}function Is(e,t){return typeof t>"u"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function Ss(e,t,s){return s&&(s[e]=t),t}function Ms(e,t){return e[t|0]}function Os(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function Ns(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function Ds(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(s,n){return e(s,n)})}function Rs(e,t,s){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(s))throw new Error("Second argument to fold is not an array");return s.reduce(function(n,a,l){return e(n,a,l)},t)}function Fs(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(s,n){return e(s,n)})}function Us(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function js(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function Ps(e){return(e>0)-(e<0)||+e}var ct=1/3;function Bs(e){return e<0?-Math.pow(-e,ct):Math.pow(e,ct)}function qs(e){return Math.exp(e)-1}function _s(e){return Math.log(1+e)}function Gs(e){return Math.log(e)/Math.LN2}function z(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||fs,cosh:Math.cosh||ms,tanh:Math.tanh||gs,asinh:Math.asinh||ks,acosh:Math.acosh||Ts,atanh:Math.atanh||ys,sqrt:Math.sqrt,cbrt:Math.cbrt||Bs,log:Math.log,log2:Math.log2||Gs,ln:Math.log,lg:Math.log10||lt,log10:Math.log10||lt,expm1:Math.expm1||qs,log1p:Math.log1p||_s,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||xs,"-":vs,"+":Number,exp:Math.exp,not:ws,length:Cs,"!":ut,sign:Math.sign||Ps},this.binaryOps={"+":Zt,"-":es,"*":ts,"/":ss,"%":ns,"^":Math.pow,"||":as,"==":rs,"!=":os,">":is,"<":ls,">=":us,"<=":ds,and:ps,or:cs,in:hs,"=":Ss,"[":Ms},this.ternaryOps={"?":pt},this.functions={random:bs,fac:ut,min:Ns,max:Os,hypot:Math.hypot||dt,pyt:Math.hypot||dt,pow:Math.pow,atan2:Math.atan2,if:pt,gamma:et,roundTo:Is,map:Ds,fold:Rs,filter:Fs,indexOf:Us,join:js},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}z.prototype.parse=function(e){var t=[],s=new b(this,new C(this,e),{allowMemberAccess:this.options.allowMemberAccess});return s.parseExpression(t),s.expect(ce,"EOF"),new _(t,this)};z.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var xt=new z;z.parse=function(e){return xt.parse(e)};z.evaluate=function(e,t){return xt.parse(e).evaluate(t)};var ht={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function Ls(e){return ht.hasOwnProperty(e)?ht[e]:e}z.prototype.isOperatorEnabled=function(e){var t=Ls(e),s=this.options.operators||{};return!(t in s)||!!s[t]};const Vs=(e,t,s)=>{const{uniqueTags:n,uniqueCategories:a}=E.useMemo(()=>{const r=new Set,i=new Set;return e.forEach(d=>{d.tags.forEach(c=>r.add(c.name)),d.category&&i.add(d.category)}),{uniqueTags:Array.from(r),uniqueCategories:Array.from(i)}},[e]);return{processedTasks:E.useMemo(()=>{let r=[...e];if(t.tags.length>0&&(r=r.filter(i=>i.tags.some(d=>t.tags.includes(d.name)))),t.categories.length>0&&(r=r.filter(i=>i.category&&t.categories.includes(i.category))),t.priorities.length>0&&(r=r.filter(i=>t.priorities.includes(i.priority))),t.statuses.length>0&&(r=r.filter(i=>t.statuses.includes(i.status))),t.enableScript&&t.script.trim())try{const i=new z,d=i.parse(t.script);r=r.filter(c=>{try{return!!d.evaluate({task:c})}catch(f){return T.error("TaskFiltering","Custom filter script execution failed",f),!1}})}catch(i){T.error("TaskFiltering","Custom filter script parsing failed",i)}return r.sort((i,d)=>{if(s.field==="custom"){if(!s.script.trim())return 0;try{const h=new z,o=h.parse(s.script),m=o.evaluate({a:i,b:d});return typeof m=="number"?m:0}catch(h){return T.error("TaskFiltering","Custom sort script failed",h),0}}let c=i[s.field],f=d[s.field];if(s.field==="priority"){const h={high:3,medium:2,low:1};c=h[i.priority],f=h[d.priority]}return c==null&&(c=""),f==null&&(f=""),c<f?s.direction==="asc"?-1:1:c>f?s.direction==="asc"?1:-1:0}),r},[e,t,s]),uniqueTags:n,uniqueCategories:a}},$s=e=>E.useMemo(()=>e.reduce((t,s)=>(s.status==="done"||s.status==="cancelled"||(s.status==="todo"&&t.todo++,s.status==="unplanned"&&t.unplanned++,s.status==="scheduled"&&t.scheduled++,s.status==="doing"&&t.doing++,(s.status==="overdue"||s.status==="due")&&t.urgent++),t),{todo:0,unplanned:0,urgent:0,scheduled:0,doing:0}),[e]);var Ks={};const Ys=(e,t,s,n,a,l,r,i)=>{const d=E.useRef(e);E.useEffect(()=>{d.current=e},[e]);const c=async h=>{const o=h.args,m=d.current;switch(T.info("AI",`Executing tool: ${h.name}`,o),h.name){case"create_task":{const k={id:`ai-${Date.now()}-${Math.random().toString(36).slice(2,5)}`,title:o.title,description:o.description,status:"todo",priority:o.priority||"medium",createdAt:new Date().toISOString(),dueAt:o.dueAt||new Date().toISOString().split("T")[0],category:o.category,tags:o.tags?o.tags.map(w=>({id:`tag-${w}`,name:w})):[]};return await t(k),r("success","Task Created",`"${k.title}" added to your list.`),T.info("AI","Tool Result: Task Created",{id:k.id}),{success:!0,id:k.id,message:"Task created successfully"}}case"query_tasks":{let k=m;if(o.status&&(k=k.filter(w=>w.status===o.status)),o.date&&(k=k.filter(w=>{const S=["startAt","createdAt","completedAt","dueAt"];for(const P of S)if(w[P]&&w[P].startsWith(o.date))return!0;return!1})),o.search){const w=o.search.toLowerCase();k=k.filter(S=>S.title.toLowerCase().includes(w))}return T.debug("AI",`Tool Result: Query found ${k.length} tasks`),k.map(w=>({id:w.id,title:w.title,dueAt:w.dueAt,status:w.status}))}case"update_task":{const k=m.find(M=>M.id===o.id);if(!k)return r("error","Update Failed",`Could not find task with ID ${o.id}`),T.warn("AI","Tool Result: Update Failed (Not Found)",{id:o.id}),{success:!1,message:"Task not found"};const w=[];Object.keys(o).forEach(M=>{M!=="id"&&o[M]!==k[M]&&w.push(M)});const S={...k,...o};await s(S,k);const P=w.length>0?`Updated ${w.join(", ")}`:"Updated properties";return r("success","Task Updated",`${P} for "${k.title}"`),T.info("AI","Tool Result: Task Updated",{id:o.id,fields:w}),{success:!0,message:"Updated"}}case"delete_task":{const k=m.find(w=>w.id===o.id);return k?(await n(o.id,k),r("info","Task Deleted",`Removed "${k.title}"`),T.info("AI","Tool Result: Task Deleted",{id:o.id}),{success:!0,message:"Deleted"}):(r("error","Delete Failed",`Could not find task with ID ${o.id}`),T.warn("AI","Tool Result: Delete Failed (Not Found)",{id:o.id}),{success:!1,message:"Task not found"})}default:return T.error("AI",`Unknown tool called: ${h.name}`),{error:"Unknown tool"}}};return{handleAICommand:async h=>{const o=a.aiConfig.providers[a.aiConfig.activeProvider];if(a.aiConfig.activeProvider!=="gemini"){r("error","Provider Not Supported","Only Gemini provider is fully implemented in this demo.");return}const m=new Bt({apiKey:Ks.API_KEY}),k=Yt();try{T.info("AI","Sending prompt to Gemini",{input:h,model:o.model});const w=m.chats.create({model:o.model||"gemini-3-flash-preview",config:{systemInstruction:`You are a task manager agent. You have tools to query, create, update, and delete tasks. When asked to modify tasks based on criteria (e.g. 'all tasks next week'), ALWAYS query_tasks first to get their IDs. Today is ${new Date().toISOString()}`,tools:[{functionDeclarations:k}]}});let S=await w.sendMessage({message:h});if(S.usageMetadata&&i){const I=S.usageMetadata.totalTokenCount||0;i(I),T.debug("AI","Token Usage",{tokens:I})}let P=0;const M=5;for(;S.functionCalls&&S.functionCalls.length>0&&P<M;){P++;const I=[];for(const j of S.functionCalls){const G=await c(j);I.push({functionResponse:{id:j.id,name:j.name,response:{result:G}}})}if(S=await w.sendMessage({message:I}),S.usageMetadata&&i){const j=S.usageMetadata.totalTokenCount||0;i(j)}}}catch(w){console.error("AI Error",w),r("error","AI Agent Error","Something went wrong while processing your request."),T.error("AI","Agent processing failed",w)}}}},q={theme:"light",dateFormat:"MMM d",showCompleted:!0,showProgressBar:!0,soundEnabled:!1,fontSize:"base",useRelativeDates:!0,groupingStrategy:["dueAt"],enableVoiceInput:!0,voiceProvider:"browser",defaultFocusMode:!1,totalTokenUsage:0,defaultCategory:"General",settingButtonOnInputBar:void 0,aiConfig:{enabled:!0,defaultMode:!1,activeProvider:"gemini",providers:{gemini:{apiKey:"",model:"gemini-3-flash-preview",baseUrl:""},openai:{apiKey:"",model:"gpt-4o",baseUrl:""},anthropic:{apiKey:"",model:"claude-3-5-sonnet-20240620",baseUrl:""}}},filters:{tags:[],categories:[],priorities:[],statuses:[],enableScript:!1,script:""},sort:{field:"createdAt",direction:"asc",script:""}},bt=({className:e,tasks:t,onTaskAdded:s,onTaskUpdated:n,onTaskDeleted:a,settingsRepository:l,apiKey:r,systemInDarkMode:i,onItemClick:d,customSettingsTabs:c})=>{const[f,h]=E.useState(!1),[o,m]=E.useState(null),[k,w]=E.useState(null),[S,P]=E.useState([]),M=E.useMemo(()=>l||new Wt,[l]),[I,j]=E.useState(()=>r?{...q,aiConfig:{...q.aiConfig,providers:{...q.aiConfig.providers,gemini:{...q.aiConfig.providers.gemini,apiKey:r}}}}:q),[G,he]=E.useState(!1),[te,qe]=E.useState(q.defaultFocusMode),[tt,fe]=E.useState(!1);E.useEffect(()=>{(async()=>{T.info("App","Loading settings...");try{const g=await M.loadSettings();if(g){const v={...q,...g,aiConfig:{...q.aiConfig,...g.aiConfig||{},providers:{...q.aiConfig.providers,...g.aiConfig?.providers||{}}}};r&&(v.aiConfig.providers.gemini.apiKey=r),j(v),qe(v.defaultFocusMode),fe(v.aiConfig.enabled&&v.aiConfig.defaultMode)}else fe(q.aiConfig.enabled&&q.aiConfig.defaultMode);he(!0)}catch(g){T.error("App","Failed to load settings",g),he(!0)}})()},[M,r]),E.useEffect(()=>{G&&M.saveSettings(I)},[I,M,G]);const L=(p,g,v)=>{const W=Math.random().toString(36).slice(2,11);P(Le=>[...Le,{id:W,type:p,title:g,description:v}]),T.info("Notification",g,{type:p,description:v})},At=p=>{P(g=>g.filter(v=>v.id!==p))},Et=p=>{j(g=>({...g,totalTokenUsage:g.totalTokenUsage+p}))},[se,_e]=E.useState(I.filters),[st,Ct]=E.useState(I.sort),It=E.useDeferredValue(se),me=I.theme==="system"?i?"midnight":"light":I.theme;E.useEffect(()=>{T.info("App","system in dark mode: ",i),k&&(T.info("App","set theme on outer container: ",me),k.setAttribute("data-theme",me))},[me,k,i]);const{processedTasks:St,uniqueTags:nt,uniqueCategories:Ge}=Vs(t,It,st),pe=$s(t),at=async p=>{const g=t.find(W=>W.id===p.id);if(!g){console.warn(`Task ${p.id} not found`);return}const v={...p,status:ot(p)};T.info("Task","Updated task",{id:v.id,title:v.title});try{await n(v,g)}catch(W){T.error("Task","Failed to update task",{error:W}),L("error","Update Failed","Could not save changes")}},Mt=async p=>{const g=t.find(v=>v.id===p);if(!g){console.warn(`Task ${p} not found`);return}L("info","Task Deleted","Item removed from your list"),T.info("Task","Deleted task",{id:p});try{await a(p,g)}catch(v){T.error("Task","Failed to delete task",{error:v}),L("error","Delete Failed","Could not remove task")}},Ot=p=>{at(p),m(null)},rt=async(p,g)=>{let v;const W={id:`new-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,status:"todo",createdAt:new Date().toISOString(),priority:"medium",tags:[],category:I.defaultCategory};if(typeof p=="string"&&g)v={...W,title:g,dueAt:p};else if(typeof p=="object")v={...W,title:"New Task",...p},v.title||(v.title="Untitled Task");else return;v.status=ot(v),T.info("Task","Created task",{id:v.id,title:v.title});try{await s(v)}catch(Le){T.error("Task","Failed to add task",{error:Le}),L("error","Add Failed","Could not create task")}},{handleAICommand:Nt}=Ys(t,s,n,a,I,rt,L,Et),ge=p=>{const g=p.every(v=>se.statuses.includes(v))&&se.statuses.length===p.length;_e(v=>({...v,statuses:g?[]:p}))},ke=p=>p.every(g=>se.statuses.includes(g))&&se.statuses.length===p.length,Dt=p=>{L("error","Voice Input Error",p),T.error("Voice",p)};return u.jsx("div",{ref:w,className:ne("tasks-timeline-app bg-paper text-slate-900 font-sans selection:bg-rose-100 selection:text-rose-900 transition-colors duration-300 antialiased",e),children:u.jsx(qt,{theme:me,children:u.jsx(_t,{value:{tasks:St,availableCategories:Ge,availableTags:nt,onUpdateTask:at,onDeleteTask:Mt,onAddTask:rt,onEditTask:m,onAICommand:Nt,onItemClick:d},children:u.jsx(Gt,{value:{settings:I,updateSettings:p=>j(g=>({...g,...p})),isFocusMode:te,toggleFocusMode:()=>qe(!te),isAiMode:tt,toggleAiMode:()=>fe(!tt),filters:se,onFilterChange:_e,sort:st,onSortChange:Ct,onVoiceError:Dt,onOpenSettings:I.settingButtonOnInputBar===!1?void 0:()=>h(!0)},children:u.jsxs("div",{className:"max-w-3xl mx-auto min-h-screen bg-white shadow-xl shadow-slate-200/50 border-x border-slate-100 pb-10 relative",children:[u.jsxs("div",{className:"sticky top-0 z-40 bg-white/95 backdrop-blur-md border-b border-slate-200/60 shadow-sm transition-all duration-300",children:[u.jsx($e,{FallbackComponent:gt,onError:(p,g)=>{T.error("InputBar","Error caught by boundary",{error:p,info:g}),L("error","Input Error",p instanceof Error?p.message:String(p))},onReset:()=>{fe(!1)},children:u.jsx(Ft,{})}),u.jsx("div",{className:"px-4 sm:px-6 pb-3",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs("button",{onClick:()=>qe(!te),className:ne("rounded-lg p-2 flex flex-col items-center justify-center border w-20 shrink-0 transition-all",te?"bg-purple-100 border-purple-400 text-purple-700 shadow-inner":"bg-slate-50 border-slate-100 text-slate-400 hover:text-slate-600 hover:border-slate-200"),title:te?"Turn Off Focus Mode":"Turn On Focus Mode",children:[u.jsx(Re,{name:te?"Minimize2":"Target",size:20,className:"mb-0.5"}),u.jsx("span",{className:"text-[9px] font-bold uppercase tracking-wider",children:"Focus"})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2 flex-1",children:[u.jsxs("button",{onClick:()=>ge(["todo"]),className:ne("rounded-lg p-2 flex flex-col items-center justify-center border",ke(["todo"])?"bg-slate-100 border-slate-400":"bg-slate-50 border-slate-100"),children:[u.jsx("span",{className:"text-lg font-black text-slate-800 leading-none",children:pe.todo}),u.jsx("span",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-wider mt-1",children:"To Do"})]}),u.jsxs("button",{onClick:()=>ge(["unplanned"]),className:ne("rounded-lg p-2 flex flex-col items-center justify-center border",ke(["unplanned"])?"bg-purple-100 border-purple-400":"bg-purple-50 border-purple-100"),children:[u.jsx("span",{className:"text-lg font-black text-purple-600 leading-none",children:pe.unplanned}),u.jsx("span",{className:"text-[9px] font-bold text-purple-400 uppercase tracking-wider mt-1",children:"Unplanned"})]}),u.jsxs("button",{onClick:()=>ge(["due","overdue"]),className:ne("rounded-lg p-2 flex flex-col items-center justify-center border",ke(["due","overdue"])?"bg-rose-100 border-rose-400":"bg-rose-50 border-rose-100"),children:[u.jsx("span",{className:"text-lg font-black text-rose-600 leading-none",children:pe.urgent}),u.jsx("span",{className:"text-[9px] font-bold text-rose-400 uppercase tracking-wider mt-1 truncate w-full text-center",children:"Due & OD"})]}),u.jsxs("button",{onClick:()=>ge(["scheduled","doing"]),className:ne("rounded-lg p-2 flex flex-col items-center justify-center border",ke(["scheduled","doing"])?"bg-blue-100 border-blue-400":"bg-blue-50 border-blue-100"),children:[u.jsx("span",{className:"text-lg font-black text-blue-600 leading-none",children:pe.scheduled+pe.doing}),u.jsx("span",{className:"text-[9px] font-bold text-blue-400 uppercase tracking-wider mt-1",children:"Doing"})]})]})]})})]}),u.jsx("main",{className:"px-4 sm:px-6 pt-6",children:u.jsx($e,{FallbackComponent:mt,onError:(p,g)=>{T.error("TodoList","Error caught by boundary",{error:p,info:g}),L("error","Task List Error",p instanceof Error?p.message:String(p))},onReset:()=>{_e({tags:[],categories:[],priorities:[],statuses:[],script:"",enableScript:!1})},children:u.jsx(Rt,{})})}),u.jsx("footer",{className:"mt-10 py-6 text-center text-slate-400 text-xs border-t border-slate-50",children:u.jsx("p",{children:"Timeline Tasks View"})}),u.jsx("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col gap-2 pointer-events-none",children:u.jsx(Lt,{children:S.map(p=>u.jsx(Pt,{toast:p,onDismiss:At},p.id))})}),u.jsx(Ut,{isOpen:f,onClose:()=>h(!1),settings:I,onUpdateSettings:j,availableTags:nt,availableCategories:Ge,customTabs:c}),u.jsx($e,{FallbackComponent:kt,onError:(p,g)=>{T.error("TaskEditModal","Error in modal",{error:p,info:g}),L("error","Failed to Edit Task",p instanceof Error?p.message:String(p))},onReset:()=>{m(null)},children:u.jsx(jt,{isOpen:!!o,onClose:()=>m(null),task:o,onSave:Ot,availableCategories:Ge})})]})})})})})};bt.__docgenInfo={description:"",methods:[],displayName:"TasksTimelineApp",props:{className:{required:!1,tsType:{name:"string"},description:""},tasks:{required:!0,tsType:{name:"Array",elements:[{name:"Task"}],raw:"Task[]"},description:""},onTaskAdded:{required:!0,tsType:{name:"signature",type:"function",raw:"(task: Task) => void | Promise<void>",signature:{arguments:[{type:{name:"Task"},name:"task"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},onTaskUpdated:{required:!0,tsType:{name:"signature",type:"function",raw:"(task: Task, previous: Task) => void | Promise<void>",signature:{arguments:[{type:{name:"Task"},name:"task"},{type:{name:"Task"},name:"previous"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},onTaskDeleted:{required:!0,tsType:{name:"signature",type:"function",raw:"(taskId: string, previous: Task) => void | Promise<void>",signature:{arguments:[{type:{name:"string"},name:"taskId"},{type:{name:"Task"},name:"previous"}],return:{name:"union",raw:"void | Promise<void>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"}]}}},description:""},settingsRepository:{required:!1,tsType:{name:"SettingsRepository"},description:""},apiKey:{required:!1,tsType:{name:"string"},description:""},systemInDarkMode:{required:!1,tsType:{name:"boolean"},description:""},onItemClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: Task) => void",signature:{arguments:[{type:{name:"Task"},name:"item"}],return:{name:"void"}}},description:""},customSettingsTabs:{required:!1,tsType:{name:"Array",elements:[{name:"CustomSettingsTab"}],raw:"CustomSettingsTab[]"},description:"Custom tabs to inject into the Settings page"}}};const{expect:ee}=__STORYBOOK_MODULE_TEST__,On={title:"Core/TasksTimelineApp",component:bt,tags:["autodocs"],parameters:{layout:"fullscreen"},argTypes:{onItemClick:{action:"item-clicked"},onTaskAdded:{action:"task-added"},onTaskUpdated:{action:"task-updated"},onTaskDeleted:{action:"task-deleted"}}},O=Vt.mixed(10),U=e=>console.log("Clicked item:",e),N=e=>console.log("Task added:",e),D=(e,t)=>console.log("Task updated:",e,"Previous:",t),R=(e,t)=>console.log("Task deleted:",e,"Previous:",t),Te={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U}},ye={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Verify app is rendered",async()=>{await H(500);const n=s.queryAllByRole("textbox");ee(n.length).toBeGreaterThan(0)})}},ve={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,className:"custom-app-class",onItemClick:U}},we={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,apiKey:"test-gemini-api-key",onItemClick:U}},xe={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,systemInDarkMode:!0,onItemClick:U},parameters:{backgrounds:{default:"dark"}}},be={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,systemInDarkMode:!1,onItemClick:U},parameters:{backgrounds:{default:"light"}}},Ae={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Find and click settings button",async()=>{await H(500);const n=s.getAllByRole("button");ee(n.length).toBeGreaterThan(0)})}},Ee={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Find Focus mode toggle",async()=>{await H(500);const n=s.getAllByRole("button");ee(n.length).toBeGreaterThan(0)})}},Ce={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Find status filter buttons",async()=>{await H(500);const n=s.getAllByRole("button");ee(n.length).toBeGreaterThan(3)})}},Ie={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Find input bar",async()=>{await H(500);const n=s.queryAllByRole("textbox");ee(n.length).toBeGreaterThan(0)})}},Se={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Verify scrollable content",async()=>{await H(500);const n=s.queryAllByRole("button");ee(n.length).toBeGreaterThan(0)})}},Me={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,onItemClick:U},play:async({canvasElement:e,step:t})=>{const s=Q(e);await t("Verify dashboard stats are visible",async()=>{await H(500);const n=s.getAllByRole("button");ee(n.length).toBeGreaterThan(3)})}},Oe={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R}},Ne={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,apiKey:"",onItemClick:U}},De={args:{tasks:O,onTaskAdded:N,onTaskUpdated:D,onTaskDeleted:R,className:"very-long-custom-class-name-that-might-cause-issues-but-should-still-work",onItemClick:U}};Te.parameters={...Te.parameters,docs:{...Te.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  }
}`,...Te.parameters?.docs?.source}}};ye.parameters={...ye.parameters,docs:{...ye.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Verify app is rendered", async () => {
      await delay(500);
      // Should have input bar
      const inputs = canvas.queryAllByRole("textbox");
      expect(inputs.length).toBeGreaterThan(0);
    });
  }
}`,...ye.parameters?.docs?.source}}};ve.parameters={...ve.parameters,docs:{...ve.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    className: "custom-app-class",
    onItemClick: handleItemClick
  }
}`,...ve.parameters?.docs?.source}}};we.parameters={...we.parameters,docs:{...we.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    apiKey: "test-gemini-api-key",
    onItemClick: handleItemClick
  }
}`,...we.parameters?.docs?.source}}};xe.parameters={...xe.parameters,docs:{...xe.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    systemInDarkMode: true,
    onItemClick: handleItemClick
  },
  parameters: {
    backgrounds: {
      default: "dark"
    }
  }
}`,...xe.parameters?.docs?.source}}};be.parameters={...be.parameters,docs:{...be.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    systemInDarkMode: false,
    onItemClick: handleItemClick
  },
  parameters: {
    backgrounds: {
      default: "light"
    }
  }
}`,...be.parameters?.docs?.source}}};Ae.parameters={...Ae.parameters,docs:{...Ae.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Find and click settings button", async () => {
      await delay(500); // Wait for app to initialize
      const buttons = canvas.getAllByRole("button");
      // Settings button should be among the buttons
      expect(buttons.length).toBeGreaterThan(0);
    });
  }
}`,...Ae.parameters?.docs?.source}}};Ee.parameters={...Ee.parameters,docs:{...Ee.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Find Focus mode toggle", async () => {
      await delay(500);
      const buttons = canvas.getAllByRole("button");
      // Should have Focus button
      expect(buttons.length).toBeGreaterThan(0);
    });
  }
}`,...Ee.parameters?.docs?.source}}};Ce.parameters={...Ce.parameters,docs:{...Ce.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Find status filter buttons", async () => {
      await delay(500);
      // Should have To Do, Unplanned, Due & OD, Doing buttons
      const buttons = canvas.getAllByRole("button");
      expect(buttons.length).toBeGreaterThan(3);
    });
  }
}`,...Ce.parameters?.docs?.source}}};Ie.parameters={...Ie.parameters,docs:{...Ie.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Find input bar", async () => {
      await delay(500);
      const inputs = canvas.queryAllByRole("textbox");
      // Should have task input field
      expect(inputs.length).toBeGreaterThan(0);
    });
  }
}`,...Ie.parameters?.docs?.source}}};Se.parameters={...Se.parameters,docs:{...Se.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Verify scrollable content", async () => {
      await delay(500);
      // App should render with buttons and input
      const buttons = canvas.queryAllByRole("button");
      expect(buttons.length).toBeGreaterThan(0);
    });
  }
}`,...Se.parameters?.docs?.source}}};Me.parameters={...Me.parameters,docs:{...Me.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    onItemClick: handleItemClick
  },
  play: async ({
    canvasElement,
    step
  }) => {
    const canvas = withinShadow(canvasElement);
    await step("Verify dashboard stats are visible", async () => {
      await delay(500);
      const buttons = canvas.getAllByRole("button");
      // Should show stat cards (To Do, Unplanned, Due & OD, Doing)
      expect(buttons.length).toBeGreaterThan(3);
    });
  }
}`,...Me.parameters?.docs?.source}}};Oe.parameters={...Oe.parameters,docs:{...Oe.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted
    // OnItemClick is optional, should work without it
  }
}`,...Oe.parameters?.docs?.source}}};Ne.parameters={...Ne.parameters,docs:{...Ne.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    apiKey: "",
    onItemClick: handleItemClick
  }
}`,...Ne.parameters?.docs?.source}}};De.parameters={...De.parameters,docs:{...De.parameters?.docs,source:{originalSource:`{
  args: {
    tasks: mockTasks,
    onTaskAdded: handleTaskAdded,
    onTaskUpdated: handleTaskUpdated,
    onTaskDeleted: handleTaskDeleted,
    className: "very-long-custom-class-name-that-might-cause-issues-but-should-still-work",
    onItemClick: handleItemClick
  }
}`,...De.parameters?.docs?.source}}};const Nn=["App","WithItemClick","WithCustomClassName","WithAPIKey","SystemDarkMode","SystemLightMode","OpenSettings","ToggleFocusMode","FilterByStatus","AddNewTask","ScrollTasks","ViewTaskStats","NoOnItemClick","EmptyAPIKey","VeryLongClassName"];export{Ie as AddNewTask,Te as App,Ne as EmptyAPIKey,Ce as FilterByStatus,Oe as NoOnItemClick,Ae as OpenSettings,Se as ScrollTasks,xe as SystemDarkMode,be as SystemLightMode,Ee as ToggleFocusMode,De as VeryLongClassName,Me as ViewTaskStats,we as WithAPIKey,ve as WithCustomClassName,ye as WithItemClick,Nn as __namedExportsOrder,On as default};
