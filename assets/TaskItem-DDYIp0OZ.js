import{j as t}from"./jsx-runtime-u17CrQMm.js";import{r as p}from"./iframe-Kgc_7zLZ.js";import{D as d}from"./datetime-CoIMkCUY.js";import{R as ee,c as s}from"./rruleset-Bu4wjl4G.js";import{I as u}from"./Icon-By9zMJNh.js";import{M as B,a as P}from"./Motion-CW3vvHgC.js";import{D as y}from"./DateBadge-VIrexBWK.js";import{T as te}from"./TagBadge-DdjIChl0.js";import{P as re}from"./PriorityPopover-CEwfVsCu.js";import{C as ae}from"./CategoryPopover-DU8vkvJF.js";import{u as se,a as ne}from"./SettingsContext-BtnD2K3E.js";import{P as le,a as ie,b as oe,j as H}from"./popover-DjtUOgMF.js";const N=e=>{if(!e)return d.invalid("No date");const a=d.fromISO(e);return a.isValid?a:d.invalid("Invalid ISO")},de=(e,a="yyyy-MM-dd")=>{const n=N(e);return n.isValid?n.toFormat(a):""},L=e=>{const a=N(e);return!a.isValid||!e.includes("T")?null:a.toFormat("HH:mm")},De=e=>{const a=N(e);if(!a.isValid)return"";const n=d.now().startOf("day"),x=a.startOf("day"),o=x.diff(n,"days").days;return o===0?"Today":o===1?"Tomorrow":o===-1?"Yesterday":a.toFormat("MMM d")},j=(e,a,n)=>{if(!a)return de(e,n);const x=N(e);if(!x.isValid)return"INVALID";const o=d.now().startOf("day"),f=x.startOf("day"),m=f.diff(o,"days").days;return m===0?"Today":m===1?"Tomorrow":m===-1?"Yesterday":Math.abs(m)<=5?f.toRelative({base:o,unit:"days"})||"INVALID":f.toRelative({base:o})||"INVALID"},ce=e=>{if(!e)return"";try{return ee.fromString(e).toText()}catch{return e}},ue=()=>d.now().toISODate()||"",we=()=>d.now().toISO()||"",C=e=>e?d.fromISO(e).isValid:!1,me=({task:e,dateValidation:a})=>{const{onUpdateTask:n,onDeleteTask:x,onEditTask:o,availableCategories:f,onItemClick:m,renderTitle:E}=se(),{settings:l}=ne(),[g,h]=p.useState(!1),[T,D]=p.useState(e.title),[b,M]=p.useState(!1),w=p.useRef(null),A=p.useRef(null),I=e.status==="done",R=e.status==="cancelled",z=ue(),S=!I&&!R&&e.priority==="high"&&(e.status==="overdue"||e.status==="due"||e.dueAt&&e.dueAt<=z),V={sm:"text-sm",base:"text-base",lg:"text-lg",xl:"text-xl"}[l.fontSize]||"text-sm",q={sm:"mt-0.5",base:"mt-0.5",lg:"mt-1",xl:"mt-1.5"}[l.fontSize]||"mt-0.5",F={sm:"text-[10px]",base:"text-[11px]",lg:"text-xs",xl:"text-sm"}[l.fontSize]||"text-[11px]";p.useEffect(()=>{g&&A.current&&A.current.focus()},[g]);const K=r=>{const i=d.now().toISO(),v={status:r};(r==="doing"||r==="scheduled")&&!e.startAt&&e.status==="todo"&&(v.startAt=i||void 0),r==="done"&&!e.completedAt&&(v.completedAt=i||void 0),r==="cancelled"&&!e.cancelledAt&&(v.cancelledAt=i||void 0),n({...e,...v})},U=()=>{T.trim()?n({...e,title:T}):D(e.title),h(!1)},Y=r=>{r.key==="Enter"&&U(),r.key==="Escape"&&(D(e.title),h(!1))},_=()=>{b?(x(e.id),w.current&&window.clearTimeout(w.current)):(M(!0),w.current=window.setTimeout(()=>{M(!1)},2e3))},W=(r,i)=>i==="done"||i==="cancelled"?"text-emerald-600 bg-emerald-50 border-emerald-200":r?i==="overdue"||r<z?"text-rose-600 bg-rose-50 border-rose-200":r===z?"text-amber-600 bg-amber-50 border-amber-200":"text-emerald-600 bg-emerald-50 border-emerald-200":"text-slate-400",X=r=>{switch(r){case"done":return"bg-emerald-500";case"doing":return"bg-sky-500";case"scheduled":return"bg-blue-500";case"due":return"bg-amber-500";case"overdue":return"bg-rose-500";case"cancelled":return"bg-slate-300";case"unplanned":return"bg-purple-500";default:return"bg-slate-200"}},Z=r=>{switch(r){case"done":return"CheckCircle2";case"doing":return"PlayCircle";case"scheduled":return"Clock";case"due":return"AlertCircle";case"overdue":return"AlertTriangle";case"cancelled":return"XCircle";case"unplanned":return"Zap";default:return"Circle"}},G=r=>{switch(r){case"done":return"text-emerald-500";case"doing":return"text-sky-500";case"scheduled":return"text-blue-500";case"due":return"text-amber-500";case"overdue":return"text-rose-500";case"cancelled":return"text-slate-300";case"unplanned":return"text-purple-500";default:return"text-slate-300 group-hover:text-slate-400"}},$=(r,i=16)=>t.jsx(u,{name:Z(r),size:i,className:G(r),strokeWidth:r==="done"?2.5:2}),J=["todo","doing","scheduled","done","unplanned","due","overdue","cancelled"],Q=e.dueAt?L(e.dueAt):null,k=e.startAt?L(e.startAt):null,O=Q||k,c="flex items-center gap-1 min-[400px]:gap-1.5 px-1.5 min-[400px]:px-2 h-4.5 min-[400px]:h-5 rounded-full border font-medium leading-none cursor-pointer hover:bg-slate-50 transition-colors select-none text-[length:inherit]";return t.jsxs(B,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,height:0},className:s("group relative flex items-stretch gap-1 min-[400px]:gap-1.5 sm:gap-2 pb-1.5 pt-0.5 px-0.5 sm:px-1 transition-all rounded-lg",(I||R)&&"opacity-60",S?"bg-rose-50/60 border border-rose-100 shadow-sm shadow-rose-100/50 hover:bg-rose-100/50":"hover:bg-slate-50 border border-transparent"),children:[t.jsxs("div",{className:s("relative flex flex-col items-center shrink-0","w-4 min-[400px]:w-5 sm:w-6",q),children:[t.jsx("div",{className:s("absolute -top-1 h-6.5 w-px left-1/2 -translate-x-1/2 group-first:hidden","bg-slate-200")}),t.jsx("div",{className:s("absolute top-5 -bottom-1 w-px left-1/2 -translate-x-1/2 group-last:hidden",X(e.status))}),t.jsxs(le,{children:[t.jsx(ie,{asChild:!0,children:t.jsx("button",{className:s("relative z-10 w-6 h-6 flex items-center justify-center transition-transform active:scale-90 outline-none focus:ring-2 focus:ring-slate-200 rounded-full",S?"bg-rose-50 hover:bg-rose-100 shadow-sm":"bg-white hover:bg-slate-50"),title:`Change Status (Current: ${e.status})`,children:$(e.status,18)})}),t.jsx(oe,{side:"bottom",align:"start",sideOffset:5,collisionPadding:10,className:"z-9999 outline-none w-44 p-1.5",children:t.jsx(B,{initial:{opacity:0,scale:.9,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-5},transition:{duration:.15},children:t.jsxs("div",{className:"flex flex-col gap-0.5",children:[J.map(r=>t.jsx(H,{asChild:!0,children:t.jsx("button",{onClick:()=>K(r),children:t.jsxs("div",{className:s("w-full flex items-center gap-2.5 px-3 py-2 text-xs font-medium font-mono rounded-lg transition-all hover:bg-slate-300 text-left outline-none","justify-start! text-left!",e.status===r?"bg-slate-200/60 text-slate-900 font-semibold":"text-slate-600 hover:text-slate-900 hover:opacity-80 active:scale-[0.98]"),children:[t.jsx("div",{className:s("shrink-0",e.status===r?"opacity-100":"opacity-70"),children:$(r,14)}),t.jsx("span",{className:"capitalize",children:r})]})})},r)),t.jsx("div",{className:"h-px bg-slate-100 my-1 mx-1"}),t.jsx(H,{asChild:!0,children:t.jsx("button",{onClick:()=>o?.(e),children:t.jsxs("div",{className:"w-full flex items-center justify-start! gap-2 px-3 py-2 text-xs font-medium text-slate-600 hover:text-blue-600 hover:opacity-80 hover:bg-slate-300 transition-all text-left outline-none rounded-lg",children:[t.jsx(u,{name:"Pencil",size:14,className:"opacity-70"}),t.jsx("span",{children:"Edit Details"})]})})})]})})})]})]}),t.jsxs("div",{className:s("flex-1 min-w-0 pt-0.5",O?"pr-12 sm:pr-16":"pr-6 sm:pr-8"),children:[t.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 min-h-5.5 mb-0.5",children:[g?t.jsx("input",{ref:A,value:T,onChange:r=>D(r.target.value),onBlur:U,onKeyDown:Y,className:s("flex-1 min-w-0 bg-transparent border-b border-blue-400 focus:outline-none font-medium text-slate-800 pb-0.5",V)}):t.jsx(t.Fragment,{children:t.jsx(P,{onClick:()=>h(!0),className:s("font-medium leading-tight text-slate-800 transition-all cursor-text text-left border-none bg-transparent p-0 appearance-none font-inherit truncate flex-1 min-w-0",V,I&&"line-through text-slate-500 decoration-slate-300",R&&"line-through text-slate-400 decoration-slate-300",S&&"text-rose-700 font-semibold"),children:E?E(e.title):e.title})}),!g&&t.jsx(P,{whileHover:{scale:1.1},onClick:()=>h(!0),className:"opacity-0 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-blue-500 p-1 shrink-0 bg-transparent border-none",children:t.jsx(u,{name:"Pencil",size:12})})]}),t.jsxs("div",{className:s("flex flex-wrap items-center gap-1 min-[400px]:gap-1.5 sm:gap-2 font-medium text-slate-500",F),onClick:r=>{m&&r.target===r.currentTarget&&m?.(e)},children:[t.jsx(re,{task:e,onUpdate:n,badgeClass:c}),a&&(a.hasInvalidDates?t.jsxs("div",{className:"flex items-center gap-1.5 px-2 h-5 rounded-full border font-medium leading-none text-rose-600 bg-rose-50 border-rose-200",title:"One or more dates have an invalid format",children:[t.jsx(u,{name:"AlertTriangle",size:10}),t.jsx("span",{className:"text-[10px]",children:"Invalid Date"})]}):a.hasMissingDates?t.jsxs("div",{className:"flex items-center gap-1.5 px-2 h-5 rounded-full border font-medium leading-none text-amber-600 bg-amber-50 border-amber-200",title:"This task has no dates set",children:[t.jsx(u,{name:"AlertCircle",size:10}),t.jsx("span",{className:"text-[10px]",children:"No Dates"})]}):null),e.category&&t.jsx(ae,{task:e,onUpdate:n,badgeClass:c,availableCategories:f}),!l.groupingStrategy.includes("createdAt")&&C(e.createdAt)&&t.jsx(y,{type:"createdAt",date:e.createdAt,label:j(e.createdAt,l.useRelativeDates,l.dateFormat),task:e,onUpdate:n,icon:"Plus",className:s(c,"text-slate-500 bg-slate-50 border-slate-200","hidden min-[400px]:flex")}),C(e.startAt)&&t.jsx(y,{type:"startAt",date:e.startAt,label:j(e.startAt,l.useRelativeDates,l.dateFormat),icon:"PlayCircle",task:e,onUpdate:n,className:s(c,"text-slate-500 bg-slate-50 border-slate-200")}),C(e.dueAt)&&t.jsx(y,{type:"dueDate",date:e.dueAt,label:`Due: ${j(e.dueAt,l.useRelativeDates,l.dateFormat)}`,icon:"Calendar",task:e,onUpdate:n,className:s(c,W(e.dueAt,e.status))}),C(e.completedAt)&&t.jsx(y,{type:"completedAt",date:e.completedAt,label:`Done: ${j(e.completedAt,l.useRelativeDates,l.dateFormat)}`,icon:"CheckCircle2",task:e,onUpdate:n,className:s(c,"text-emerald-600 bg-emerald-50 border-emerald-200")}),e.isRecurring&&e.recurringInterval&&t.jsxs("div",{className:s(c,"text-slate-500 bg-slate-100 border-slate-200 cursor-default"),title:ce(e.recurringInterval),children:[t.jsx(u,{name:"Repeat",size:10}),t.jsx("span",{className:"capitalize",children:"Recurring"})]}),e.tags.map((r,i)=>t.jsx(te,{tag:r,task:e,onUpdate:n,badgeClass:c},`${e.id}-tag-${i}`))]}),e.description&&t.jsxs("div",{className:"mt-1 flex items-start gap-1.5 text-slate-400",children:[t.jsx(u,{name:"FileText",size:10,className:"mt-0.5 shrink-0"}),t.jsx("p",{className:s("leading-relaxed line-clamp-2",F),children:e.description})]})]}),O&&t.jsx("div",{className:"absolute right-8 top-3 text-[10px] font-mono font-bold text-slate-400 bg-slate-50 border border-slate-100 px-1.5 py-0.5 rounded-md",children:O}),t.jsx(P,{onClick:_,className:s("absolute top-2 right-1 p-1.5 rounded-md transition-all",b?"bg-rose-100 text-rose-600 opacity-100":"text-slate-300 opacity-0 group-hover:opacity-100 hover:text-rose-500 hover:bg-slate-100"),whileHover:{scale:1.1},whileTap:{scale:.9},title:b?"Click again to confirm delete":"Delete task",children:t.jsx(u,{name:b?"Trash2":"Trash",size:14})})]})};me.__docgenInfo={description:"",methods:[],displayName:"TaskItem",props:{task:{required:!0,tsType:{name:"Task"},description:""},dateValidation:{required:!1,tsType:{name:"DateValidationState"},description:""}}};export{me as T,we as a,De as f,ue as g};
