import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as a}from"./iframe-Zi-gTbRm.js";import{D as L}from"./datetime-CoIMkCUY.js";import{f as V,T as M}from"./TaskItem-DlutzZB_.js";import{I as n}from"./Icon-C9gs-eIT.js";import{c as f}from"./rruleset-Bu4wjl4G.js";import{u as P}from"./useVoiceInput-Cs3CcRcX.js";import{u as q,a as H}from"./SettingsContext-edzBkBLG.js";import{C as K,a as _,b as B}from"./collapsible-DaLMx4ti.js";import{m as v}from"./proxy-B_Q68Ehr.js";import{A as G}from"./index-BcoNlowd.js";const U=({group:s})=>{const{onAddTask:w,onAICommand:T}=q(),{settings:o,isAiMode:c,onVoiceError:S}=H(),[h,I]=a.useState(!0),[i,m]=a.useState(!1),[p,x]=a.useState(""),[g,y]=a.useState(o.defaultCategory),[N,C]=a.useState(!1),b=a.useRef(null);a.useEffect(()=>{i&&y(o.defaultCategory)},[i,o.defaultCategory]);const{isListening:l,start:A,stop:D}=P(o.voiceConfig,t=>x(r=>r?`${r} ${t}`:t),S),j=L.fromISO(s.date),z=j.toFormat("ccc"),$=j.weekday>5,E=$?"text-rose-500 bg-rose-50 border-rose-100":"text-slate-600 bg-slate-50 border-slate-200",u=V(s.date),k=u==="Today"||u==="Tomorrow"||u==="Yesterday",R=j.toFormat(o.dateFormat);a.useEffect(()=>{i&&b.current&&b.current.focus()},[i]);const d=a.useMemo(()=>s.tasks.reduce((t,r)=>(r.status==="done"?t.done++:r.status==="overdue"||r.status==="due"?t.urgent++:["todo","scheduled","unplanned"].includes(r.status)&&t.open++,t),{done:0,urgent:0,open:0}),[s.tasks]),O=async()=>{if(!p.trim()){m(!1);return}C(!0);try{if(o.aiConfig.enabled&&c){const t=`Add task to ${s.date}: ${p} (Category: ${g})`;await T(t)}else w({title:p,dueAt:s.date,category:g});x("")}catch(t){console.error(t)}finally{C(!1)}},W=t=>{t.key==="Enter"&&O(),t.key==="Escape"&&(m(!1),x(""))},F={sm:"mt-0.5",base:"mt-0.5",lg:"mt-1",xl:"mt-1.5"}[o.fontSize]||"mt-0.5";return e.jsx("div",{className:"mb-2 relative",children:e.jsxs(K,{open:h,onOpenChange:I,children:[e.jsx(_,{asChild:!0,children:e.jsxs("button",{className:"w-full flex items-center justify-between mb-1 sticky top-0 bg-paper/95 backdrop-blur-sm z-20 py-1.5 border-b border-dashed border-slate-200 group hover:border-slate-300 transition-colors text-left outline-none pl-2",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(v.div,{animate:{rotate:h?90:0},transition:{duration:.2},className:"text-slate-400",children:e.jsx(n,{name:"ChevronRight",size:14})}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[k&&e.jsx("span",{className:"text-xs font-bold text-blue-600 font-mono uppercase tracking-tight",children:u}),e.jsx("h3",{className:`text-sm font-bold text-slate-800 font-mono tracking-tight group-hover:text-blue-600 transition-colors ${k?"opacity-60 font-normal":""}`,children:R})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 opacity-80 group-hover:opacity-100 transition-opacity",children:[d.urgent>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-rose-100/50 text-rose-600 border border-rose-200/50 shadow-sm shadow-rose-100",children:[e.jsx(n,{name:"AlertCircle",size:10,strokeWidth:2.5}),e.jsx("span",{className:"text-[10px] font-bold leading-none",children:d.urgent})]}),d.open>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-slate-100 text-slate-500 border border-slate-200 shadow-sm shadow-slate-100",children:[e.jsx(n,{name:"Circle",size:10,strokeWidth:2.5}),e.jsx("span",{className:"text-[10px] font-bold leading-none",children:d.open})]}),d.done>0&&e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-emerald-100/50 text-emerald-600 border border-emerald-200/50 shadow-sm shadow-emerald-100",children:[e.jsx(n,{name:"CheckCircle2",size:10,strokeWidth:2.5}),e.jsx("span",{className:"text-[10px] font-bold leading-none",children:d.done})]})]})]}),e.jsxs("div",{className:`flex flex-col items-center justify-center w-8 h-8 rounded-lg border ${E} shadow-sm shrink-0 ml-2`,children:[e.jsx("span",{className:"text-[10px] font-bold uppercase leading-none",children:z}),e.jsx("span",{className:"text-[10px] opacity-60 leading-none mt-0.5",children:s.tasks.length})]})]})}),e.jsx(G,{initial:!1,children:h&&e.jsx(B,{forceMount:!0,asChild:!0,children:e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-0.5 relative pb-2",children:[s.tasks.map(t=>e.jsx(M,{task:t},t.id)),e.jsxs("div",{className:"group relative flex items-stretch gap-2 py-1.5 px-1 transition-all rounded-lg",children:[e.jsxs("div",{className:f("relative flex flex-col items-center shrink-0 w-6",F),children:[s.tasks.length>0&&e.jsx("div",{className:"absolute -top-1 h-4 w-px left-1/2 -translate-x-1/2 bg-slate-200"}),e.jsx("button",{onClick:()=>m(!0),className:f("relative z-10 w-6 h-6 flex items-center justify-center rounded-full transition-all outline-none",i?c?"bg-purple-100 text-purple-600":"bg-blue-100 text-blue-600":"bg-white hover:bg-slate-100 text-slate-300 hover:text-blue-500"),children:N?e.jsx("div",{className:"animate-spin",children:e.jsx(n,{name:"Loader2",size:12})}):e.jsx(n,{name:c?"Sparkles":"Plus",size:14})})]}),e.jsx("div",{className:"flex-1 min-w-0 pt-0.5",children:i?e.jsxs(v.div,{initial:{opacity:0,x:-5},animate:{opacity:1,x:0},className:"flex items-center gap-2",children:[e.jsx("input",{ref:b,type:"text",value:p,onChange:t=>x(t.target.value),onKeyDown:W,onBlur:t=>{(!t.relatedTarget||!t.relatedTarget.closest(".add-row-actions"))&&(p||m(!1))},placeholder:l?"Listening...":c?"Describe task for this day...":"Type a new task...",className:f("flex-1 bg-transparent border-b focus:outline-none text-sm py-0.5 transition-colors",c?"border-purple-300 focus:border-purple-500 placeholder:text-purple-300 text-purple-900":"border-blue-300 focus:border-blue-500"),disabled:N||l}),e.jsxs("div",{className:"flex items-center gap-1 add-row-actions",children:[e.jsxs("div",{className:"relative group/cat",children:[e.jsx("input",{list:`cat-list-${s.date}`,className:"w-20 text-[10px] bg-slate-100 hover:bg-slate-200 border-none rounded px-1.5 py-0.5 text-slate-600 focus:bg-white focus:ring-1 focus:ring-blue-300 outline-none transition-all placeholder:text-slate-400 truncate",placeholder:"Category",value:g,onChange:t=>y(t.target.value),onFocus:()=>{},title:"Task Category"}),e.jsxs("datalist",{id:`cat-list-${s.date}`,children:[e.jsx("option",{value:"Work"}),e.jsx("option",{value:"Personal"}),e.jsx("option",{value:"Home"}),e.jsx("option",{value:"Health"}),e.jsx("option",{value:"Finance"}),e.jsx("option",{value:"Urgent"})]})]}),o.voiceConfig.enabled&&e.jsx("button",{onClick:l?D:A,className:f("p-1 rounded hover:bg-slate-100 transition-colors",l&&"text-rose-500 animate-pulse"),tabIndex:-1,title:l?"Stop Recording":"Start Voice Input",children:e.jsx(n,{name:l?"Square":"Mic",size:14})})]})]}):e.jsx("button",{onClick:()=>m(!0),className:"text-left text-sm text-slate-400 hover:text-blue-500 transition-colors h-5.5 flex items-end font-medium",children:"Add task..."})})]})]})})})})]})})};U.__docgenInfo={description:"",methods:[],displayName:"DaySection",props:{group:{required:!0,tsType:{name:"DayGroup"},description:""}}};export{U as D};
