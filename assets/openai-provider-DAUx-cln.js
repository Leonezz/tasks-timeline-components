import{_ as d}from"./preload-helper-PPVm8Dsz.js";class y{config;constructor(t){this.config=t}async getClient(){try{const{default:t}=await d(async()=>{const{default:a}=await import("./index-wummVolk.js");return{default:a}},[],import.meta.url);return new t({apiKey:this.config.apiKey,baseURL:this.config.baseUrl||void 0,dangerouslyAllowBrowser:!0})}catch{throw new Error("The 'openai' package is required. Install it with: pnpm add openai")}}async chat(t,a,i,r,u){const p=await this.getClient(),o=[{role:"system",content:t}];if(u){for(const e of u)if(e.role==="user")o.push({role:"user",content:e.content||""});else if(e.role==="assistant"){const s={role:"assistant",content:e.content||null};e.toolCalls&&e.toolCalls.length>0&&(s.tool_calls=e.toolCalls.map((m,f)=>({id:m.id||`call_${f}`,type:"function",function:{name:m.name,arguments:JSON.stringify(m.args)}}))),o.push(s)}else if(e.role==="tool"&&e.toolResults)for(const s of e.toolResults)o.push({role:"tool",content:JSON.stringify(s.result),tool_call_id:s.id||`call_${s.name}`})}if(r&&r.length>0)for(const e of r)o.push({role:"tool",content:JSON.stringify(e.result),tool_call_id:e.id||`call_${e.name}`});else o.push({role:"user",content:a});const g=i.map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters}})),c=await p.chat.completions.create({model:this.config.model||"gpt-4o",messages:o,tools:g.length>0?g:void 0}),n=c.choices[0],l={};return n?.message?.content&&(l.text=n.message.content),n?.message?.tool_calls&&n.message.tool_calls.length>0&&(l.toolCalls=n.message.tool_calls.filter(e=>e.type==="function").map(e=>({id:e.id,name:e.function.name,args:JSON.parse(e.function.arguments)}))),c.usage&&(l.tokenCount=c.usage.total_tokens),l}async test(){try{const i=(await(await this.getClient()).chat.completions.create({model:this.config.model||"gpt-4o",messages:[{role:"user",content:"Say hello in one word."}],max_tokens:10})).choices[0]?.message?.content?.trim();return{success:!0,message:`Connected to ${this.config.model||"gpt-4o"}. Response: "${i}"`}}catch(t){return{success:!1,message:t instanceof Error?t.message:"Unknown error"}}}}export{y as OpenAIProvider};
