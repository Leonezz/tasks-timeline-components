import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as S}from"./iframe-MqrkKuKk.js";import{R as s,W as O,c as g}from"./index-goBt61iM.js";import{D as b}from"./datetime-CoIMkCUY.js";import{I as f}from"./Icon-vyFwuaK4.js";import{D as v}from"./date-picker-37m_hStc.js";import{A as T}from"./index-CD4A-hWf.js";import{m as N}from"./proxy-BsFmiW0h.js";const I=[{value:s.DAILY,label:"Daily"},{value:s.WEEKLY,label:"Weekly"},{value:s.MONTHLY,label:"Monthly"},{value:s.YEARLY,label:"Yearly"}],L=[{label:"M",val:s.MO},{label:"T",val:s.TU},{label:"W",val:s.WE},{label:"T",val:s.TH},{label:"F",val:s.FR},{label:"S",val:s.SA},{label:"S",val:s.SU}],W=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],q=({task:p,onSave:w,onClose:h,availableCategories:k})=>{const[a,x]=S.useState(p),[A,C]=S.useState(!1),[d,E]=S.useState(()=>{let t=s.WEEKLY,l=1,o=[],i=[],n=[],u="",c="";if(p.isRecurring&&p.recurringInterval)try{const r=s.fromString(p.recurringInterval);t=r.options.freq,l=r.options.interval;const y=r.options.byweekday;y&&(o=(Array.isArray(y)?y:[y]).map(j=>typeof j=="number"?new O(j):j)),i=r.options.bymonth?Array.isArray(r.options.bymonth)?r.options.bymonth:[r.options.bymonth]:[],n=r.options.bymonthday?Array.isArray(r.options.bymonthday)?r.options.bymonthday:[r.options.bymonthday]:[],r.options.dtstart&&(u=b.fromJSDate(r.options.dtstart).toISODate()||""),r.options.until&&(c=b.fromJSDate(r.options.until).toISODate()||"")}catch(r){console.error(`parse recurrence rule failed with err: ${r}`)}return{freq:t,interval:l,byWeekDay:o,byMonth:i,byMonthDay:n,start:u,end:c}}),m=t=>{E(l=>({...l,...t}))},Y=()=>{const t={...a};if(t.isRecurring)try{const{start:l,end:o,freq:i,interval:n,byWeekDay:u,byMonth:c,byMonthDay:r}=d,y=l?b.fromISO(l).toJSDate():void 0,R=o?b.fromISO(o).endOf("day").toJSDate():void 0,j=new s({freq:i,interval:n,byweekday:i===s.WEEKLY?u:null,bymonth:i===s.YEARLY&&c.length>0?c:null,bymonthday:(i===s.MONTHLY||i===s.YEARLY)&&r.length>0?r:null,dtstart:y,until:R});t.recurringInterval=j.toString()}catch(l){console.error("Failed to generate RRule",l)}else t.recurringInterval=void 0;w(t)},M=()=>{x(t=>({...t,isRecurring:!t.isRecurring}))},D=k.filter(t=>t.toLowerCase().includes((a.category||"").toLowerCase())&&t.toLowerCase()!==(a.category||"").toLowerCase());return e.jsxs("div",{className:"flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-slate-100 dark:border-slate-800 bg-paper/50 sticky top-0 backdrop-blur-md z-10 shrink-0",children:[e.jsx("h2",{className:"font-bold text-slate-800",children:"Edit Task"}),e.jsx("button",{onClick:h,"aria-label":"Close edit task modal",className:"p-2 text-slate-400 hover:text-slate-600 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800",children:e.jsx(f,{name:"X",size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"task-title",className:"text-xs font-semibold text-slate-500 uppercase",children:"Title"}),e.jsx("input",{id:"task-title",value:a.title,onChange:t=>x({...a,title:t.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none text-slate-900"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"task-description",className:"text-xs font-semibold text-slate-500 uppercase",children:"Description"}),e.jsx("textarea",{id:"task-description",value:a.description||"",onChange:t=>x({...a,description:t.target.value}),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none min-h-20 resize-none text-slate-900",placeholder:"Add details..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1 relative group",children:[e.jsx("label",{htmlFor:"task-category",className:"text-xs font-semibold text-slate-500 uppercase",children:"Category"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"task-category",type:"text",value:a.category||"",onChange:t=>x({...a,category:t.target.value}),onFocus:()=>C(!0),onBlur:()=>setTimeout(()=>C(!1),200),placeholder:"Work, Personal...",className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none pl-9 text-slate-900"}),e.jsx("div",{className:"absolute left-3 top-2.5 text-slate-400 pointer-events-none",children:e.jsx(f,{name:"Folder",size:14})}),e.jsx("div",{className:"absolute right-3 top-2.5 text-slate-400 pointer-events-none transition-transform duration-200",style:{transform:A?"rotate(180deg)":"rotate(0deg)"},children:e.jsx(f,{name:"ChevronDown",size:14})})]}),e.jsx(T,{children:A&&(D.length>0||a.category&&!k.includes(a.category))&&e.jsxs(N.div,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0},className:"absolute z-20 w-full mt-1 bg-white border border-slate-100 rounded-lg shadow-xl max-h-40 overflow-y-auto py-1",children:[D.map(t=>e.jsxs("button",{onClick:()=>x({...a,category:t}),className:"w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 flex items-center gap-2",children:[e.jsx(f,{name:"Folder",size:12,className:"text-slate-400"}),t]},t)),a.category&&!k.includes(a.category)&&e.jsxs("div",{className:"px-3 py-2 text-xs text-blue-600 bg-blue-50/50 border-t border-blue-100 flex items-center gap-2",children:[e.jsx(f,{name:"Plus",size:12}),'Create "',a.category,'"']})]})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{id:"priority-label",className:"text-xs font-semibold text-slate-500 uppercase",children:"Priority"}),e.jsx("div",{role:"radiogroup","aria-labelledby":"priority-label",className:"flex bg-slate-50 dark:bg-slate-800/50 p-1 rounded-lg border border-slate-200 dark:border-slate-700 h-9.5",children:["low","medium","high"].map(t=>e.jsx("button",{role:"radio","aria-checked":a.priority===t,onClick:()=>x({...a,priority:t}),className:g("flex-1 text-xs font-medium rounded-md capitalize transition-all flex items-center justify-center",a.priority===t?"bg-white dark:bg-slate-600 shadow-sm text-slate-800 dark:text-slate-100 border border-slate-100 dark:border-slate-500":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"),children:t},t))})]})]}),e.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-800 pt-4",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 block",children:"Task Dates"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Created"}),e.jsx(v,{value:a.createdAt,onChange:t=>x({...a,createdAt:t||a.createdAt}),showTime:!0,placeholder:"Select created date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Due"}),e.jsx(v,{value:a.dueAt,onChange:t=>x({...a,dueAt:t}),showTime:!0,placeholder:"Select due date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Start At"}),e.jsx(v,{value:a.startAt,onChange:t=>x({...a,startAt:t}),showTime:!0,placeholder:"Select start date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-500 uppercase",children:"Completed"}),e.jsx(v,{value:a.completedAt,onChange:t=>x({...a,completedAt:t}),showTime:!0,placeholder:"Select completed date",disabled:a.status!=="done"&&a.status!=="cancelled"})]})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/30 rounded-lg p-3 border border-slate-200/60 dark:border-slate-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:g("p-1.5 rounded-md",a.isRecurring?"bg-blue-100 text-blue-600":"bg-slate-200 text-slate-500"),children:e.jsx(f,{name:"Repeat",size:16})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Recurrence"}),e.jsx("span",{className:"text-[10px] text-slate-400",children:"Repeats automatically"})]})]}),e.jsx("button",{onClick:M,role:"switch","aria-checked":a.isRecurring,"aria-label":"Toggle task recurrence",className:g("relative w-9 h-5 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400",a.isRecurring?"bg-blue-500":"bg-slate-200 dark:bg-slate-700"),children:e.jsx(N.div,{layout:!0,className:"absolute top-1 left-1 w-3 h-3 bg-white rounded-full shadow-sm",animate:{x:a.isRecurring?16:0}})})]}),e.jsx(T,{children:a.isRecurring&&e.jsx(N.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:12},exit:{height:0,opacity:0,marginTop:0},className:"overflow-hidden",children:e.jsxs("div",{className:"pt-3 border-t border-slate-200/60 dark:border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"recurrence-interval",className:"text-xs font-medium text-slate-500",children:"Every"}),e.jsx("input",{id:"recurrence-interval",type:"number",min:"1",max:"99","aria-label":"Recurrence interval",value:d.interval,onChange:t=>m({interval:parseInt(t.target.value)||1}),className:"w-12 px-1.5 py-1 text-center bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md text-xs focus:border-blue-500 outline-none text-slate-700 dark:text-slate-200"}),e.jsx("select",{"aria-label":"Recurrence frequency",value:d.freq,onChange:t=>m({freq:parseInt(t.target.value)}),className:"flex-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-200 text-xs rounded-md focus:ring-blue-500 focus:border-blue-500 block p-1 outline-none",children:I.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),d.freq===s.WEEKLY&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{id:"weekdays-label",className:"text-[10px] font-semibold text-slate-400 uppercase",children:"On days"}),e.jsx("div",{role:"group","aria-labelledby":"weekdays-label",className:"flex justify-between",children:L.map((t,l)=>{const o=d.byWeekDay.some(n=>n.weekday===t.val.weekday),i=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsx("button",{"aria-label":i[l],"aria-pressed":o,onClick:()=>{const n=d.byWeekDay,u=n.some(c=>c.weekday===t.val.weekday);m({byWeekDay:u?n.filter(c=>c.weekday!==t.val.weekday):[...n,t.val]})},className:g("w-7 h-7 flex items-center justify-center rounded-full text-xs font-medium transition-all border",o?"bg-blue-500 text-white border-blue-600 shadow-sm":"bg-white dark:bg-slate-700 text-slate-500 dark:text-slate-400 border-slate-200 dark:border-slate-600 hover:border-blue-300 hover:text-blue-500"),children:t.label},t.label+t.val.weekday)})})]}),(d.freq===s.MONTHLY||d.freq===s.YEARLY)&&e.jsxs("div",{className:"space-y-3",children:[d.freq===s.YEARLY&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-400 uppercase",children:"Months"}),e.jsx("div",{className:"grid grid-cols-6 gap-1",children:W.map((t,l)=>{const o=l+1,i=d.byMonth.includes(o);return e.jsx("button",{onClick:()=>{const n=d.byMonth;m({byMonth:n.includes(o)?n.filter(u=>u!==o):[...n,o]})},className:g("py-1 text-[15px] rounded border transition-colors",i?"bg-blue-500 text-white border-blue-600":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 hover:border-blue-300"),children:t},t)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-400 uppercase",children:"Days"}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Array.from({length:31},(t,l)=>l+1).map(t=>{const l=d.byMonthDay.includes(t);return e.jsx("button",{onClick:()=>{const o=d.byMonthDay;m({byMonthDay:o.includes(t)?o.filter(i=>i!==t):[...o,t]})},className:g("w-full aspect-square flex items-center justify-center text-[15px] rounded border transition-colors",l?"bg-blue-500 text-white border-blue-600":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-600 text-slate-500 dark:text-slate-400 hover:border-blue-300"),children:t},t)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-slate-200/50 dark:border-slate-700/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-400 uppercase",children:"Start Recurrence"}),e.jsx(v,{value:d.start,onChange:t=>m({start:t&&b.fromISO(t).toISODate()||""}),placeholder:"Select start",className:"h-8 text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-semibold text-slate-400 uppercase",children:"End Recurrence"}),e.jsx(v,{value:d.end,onChange:t=>m({end:t&&b.fromISO(t).toISODate()||""}),placeholder:"Select end",className:"h-8 text-xs"})]})]}),e.jsx("div",{className:"text-[10px] text-slate-400 italic bg-white/50 dark:bg-slate-800/50 p-2 rounded border border-slate-100 dark:border-slate-700 text-center",children:(()=>{try{const{freq:t,interval:l,byWeekDay:o,byMonth:i,byMonthDay:n,start:u,end:c}=d;return new s({freq:t,interval:l,byweekday:t===s.WEEKLY?o:null,bymonth:t===s.YEARLY&&i.length>0?i:null,bymonthday:(t===s.MONTHLY||t===s.YEARLY)&&n.length>0?n:null,dtstart:u?b.fromISO(u).toJSDate():void 0,until:c?b.fromISO(c).endOf("day").toJSDate():void 0}).toText()}catch(t){return console.error(`invalid recurrence rule: ${t}`),"Invalid Rule"}})()})]})})})]})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-800 flex justify-end gap-3 sticky bottom-0 z-10 shrink-0",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:Y,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-sm shadow-blue-200 transition-colors",children:"Save Changes"})]})]})},F=({isOpen:p,onClose:w,task:h,onSave:k,availableCategories:a})=>e.jsx(T,{children:p&&h&&e.jsxs(e.Fragment,{children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:w,className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50"}),e.jsx(N.div,{initial:{opacity:0,scale:.95,y:"-50%",x:"-50%"},animate:{opacity:1,scale:1,y:"-50%",x:"-50%"},exit:{opacity:0,scale:.95,y:"-50%",x:"-50%"},className:"fixed top-1/2 left-1/2 w-full max-w-lg bg-paper rounded-xl shadow-2xl z-50 border border-slate-200 dark:border-slate-800 overflow-hidden text-slate-900",children:e.jsx(q,{task:h,onSave:k,onClose:w,availableCategories:a},h.id)})]})});F.__docgenInfo={description:"",methods:[],displayName:"TaskEditModal",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},task:{required:!0,tsType:{name:"union",raw:"Task | null",elements:[{name:"Task"},{name:"null"}]},description:""},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(task: Task) => void",signature:{arguments:[{type:{name:"Task"},name:"task"}],return:{name:"void"}}},description:""},availableCategories:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""}}};export{F as T};
