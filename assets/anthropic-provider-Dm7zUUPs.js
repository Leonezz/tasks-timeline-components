import{_ as d}from"./preload-helper-PPVm8Dsz.js";class g{config;constructor(o){this.config=o}async getClient(){try{const i=(await d(()=>import("./index-GHxucVRv.js"),[],import.meta.url)).default;return new i({apiKey:this.config.apiKey,baseURL:this.config.baseUrl||void 0})}catch{throw new Error("The '@anthropic-ai/sdk' package is required. Install it with: pnpm add @anthropic-ai/sdk")}}async chat(o,i,c,l,u){const p=await this.getClient(),a=[];if(u){for(const t of u)if(t.role==="user")a.push({role:"user",content:t.content||""});else if(t.role==="assistant"){const e=[];if(t.content&&e.push({type:"text",text:t.content}),t.toolCalls)for(const s of t.toolCalls)e.push({type:"tool_use",id:s.id||`toolu_${s.name}`,name:s.name,input:s.args});a.push({role:"assistant",content:e.length>0?e:""})}else if(t.role==="tool"&&t.toolResults){const e=t.toolResults.map(s=>({type:"tool_result",tool_use_id:s.id||`toolu_${s.name}`,content:JSON.stringify(s.result)}));a.push({role:"user",content:e})}}if(l&&l.length>0){const t=l.map(e=>({type:"tool_result",tool_use_id:e.id||`toolu_${e.name}`,content:JSON.stringify(e.result)}));a.push({role:"user",content:t})}else a.push({role:"user",content:i});const m=c.map(t=>({name:t.name,description:t.description,input_schema:t.parameters})),r=await p.messages.create({model:this.config.model||"claude-sonnet-4-20250514",max_tokens:4096,system:o,messages:a,tools:m}),n={};for(const t of r.content)t.type==="text"?n.text=(n.text||"")+t.text:t.type==="tool_use"&&(n.toolCalls||(n.toolCalls=[]),n.toolCalls.push({id:t.id,name:t.name,args:t.input||{}}));return r.usage&&(n.tokenCount=r.usage.input_tokens+r.usage.output_tokens),n}async test(){try{const i=await(await this.getClient()).messages.create({model:this.config.model||"claude-sonnet-4-20250514",max_tokens:10,messages:[{role:"user",content:"Say hello in one word."}]}),c=i.content[0]?.type==="text"?i.content[0].text.trim():"";return{success:!0,message:`Connected to ${this.config.model||"claude-sonnet-4-20250514"}. Response: "${c}"`}}catch(o){return{success:!1,message:o instanceof Error?o.message:"Unknown error"}}}}export{g as AnthropicProvider};
