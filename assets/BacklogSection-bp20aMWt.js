import{j as s}from"./jsx-runtime-u17CrQMm.js";import{r as v}from"./iframe-BGtqOInk.js";import{T as y}from"./TaskItem-DFdCcC3W.js";import{I as h}from"./Icon-B2foTpRx.js";import{a as j}from"./SettingsContext-DkX_1huq.js";import{u as A,C as b,a as I,b as T}from"./collapsible-lBPQBf1S.js";import"./rruleset-Bu4wjl4G.js";import{D as m}from"./datetime-CoIMkCUY.js";import{m as g}from"./proxy-DEXR2x0b.js";import{A as D}from"./index-CNQ5PkYJ.js";const O=(e,l)=>{const a=["dueAt","startAt","createdAt","completedAt"];let c=!1,d=!1;for(const r of l){const t=e[r];t?m.fromISO(t).isValid||(d=!0):c=!0}for(const r of a){const t=e[r];t&&(m.fromISO(t).isValid||(d=!0))}if(!(!c&&!d))return{hasMissingDates:c,hasInvalidDates:d}},p=e=>{if(!e)return m.invalid("No date");const l=m.fromISO(e);return l.isValid?l:m.invalid("Invalid ISO")},F=e=>{if(e.status==="done"||e.status==="cancelled")return e.status;const l=m.now(),a=l.toISODate()||"",c=l.plus({days:1}).toISODate();if(e.dueAt&&e.dueAt<a)return"overdue";if(e.dueAt&&(e.dueAt===a||e.dueAt===c))return"due";if(e.startAt){const d=m.fromISO(e.startAt);if(d.isValid)return d>l?"scheduled":"doing"}return["due","overdue","scheduled","doing"].includes(e.status)?"todo":e.status},M=(e,l=["dueAt"])=>{const a={},c=["dueAt","startAt","createdAt","completedAt"];return e.forEach(r=>{const t=[];if(l.forEach(i=>{const o=r[i];o&&p(o).isValid&&t.push(o)}),t.length===0)for(const i of c){const o=r[i];if(o&&p(o).isValid){t.push(o);break}}t.forEach(i=>{const o=p(i),{year:n}=o,u=o.toISODate();u&&(a[n]||(a[n]={}),a[n][u]||(a[n][u]=[]),a[n][u].includes(r)||a[n][u].push(r))})}),Object.keys(a).map(Number).sort((r,t)=>t-r).map(r=>{const t=a[r],i=Object.keys(t).sort((f,x)=>x.localeCompare(f)),o=i.map(f=>({date:f,tasks:t[f]})),n=Object.values(t).flat(),u=n.filter(f=>f.status==="done"||f.status==="cancelled").length;return{year:r,dayGroups:o,totalTasks:n.length,completedTasks:u}})},S=({tasks:e,lazy:l=!0})=>{const{containerRef:a,contentRef:c,isNearViewport:d,placeholderHeight:r}=A(e.length,{enabled:l}),{settings:t}=j(),[i,o]=v.useState(!0);return s.jsx("div",{className:"mt-8 pt-4 border-t border-slate-100",children:s.jsxs(b,{open:i,onOpenChange:o,children:[s.jsx(I,{asChild:!0,children:s.jsxs("button",{className:"flex items-center gap-2 mb-4 pl-2 w-full group outline-none",children:[s.jsx(g.div,{animate:{rotate:i?90:0},transition:{duration:.2},className:"text-slate-400",children:s.jsx(h,{name:"ChevronRight",size:14})}),s.jsx(h,{name:"Archive",size:14,className:"text-slate-400"}),s.jsx("h3",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider group-hover:text-slate-700 transition-colors",children:"Backlog / Undated"}),s.jsx("span",{className:"text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full font-mono",children:e.length})]})}),s.jsx(D,{initial:!1,children:i&&s.jsx(T,{forceMount:!0,asChild:!0,children:s.jsx(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:s.jsx("div",{ref:a,className:"space-y-0.5",children:d?s.jsx("div",{ref:c,children:e.map(n=>s.jsx(y,{task:n,dateValidation:O(n,t.groupingStrategy)},n.id))}):s.jsx("div",{style:{height:r},className:"bg-slate-50/30 rounded"})})})})})]})})};S.__docgenInfo={description:"",methods:[],displayName:"BacklogSection",props:{tasks:{required:!0,tsType:{name:"Array",elements:[{name:"Task"}],raw:"Task[]"},description:""},lazy:{required:!1,tsType:{name:"boolean"},description:"When false, skip lazy rendering (e.g. for standalone stories). Default: true",defaultValue:{value:"true",computed:!1}}}};export{S as B,F as d,M as g};
