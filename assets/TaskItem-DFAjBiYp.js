import{j as t}from"./jsx-runtime-u17CrQMm.js";import{r as p}from"./iframe-Cm6QGVzw.js";import{D as x}from"./tasks-BV5_RF93.js";import{R as k,c as s}from"./index-BSO_abFL.js";import{I as c}from"./Icon-5YkzlUjT.js";import{M as B,a as O}from"./Motion-DbRBu1NO.js";import{D as v}from"./DateBadge-Bm0aJhAc.js";import{T as ee}from"./TagBadge-CoC8s14U.js";import{P as te}from"./PriorityPopover-DRplVZw1.js";import{C as re}from"./CategoryPopover-DQO6iL5Q.js";import{u as ae,a as se}from"./SettingsContext-Dokk4lNj.js";import{P as ne,a as le,b as ie,j as H}from"./popover-BdNAdze1.js";const C=e=>{if(!e)return x.invalid("No date");const a=x.fromISO(e);return a.isValid?a:x.invalid("Invalid ISO")},oe=(e,a="yyyy-MM-dd")=>{const n=C(e);return n.isValid?n.toFormat(a):""},L=e=>{const a=C(e);return!a.isValid||!e.includes("T")?null:a.toFormat("HH:mm")},Ne=e=>{const a=C(e);if(!a.isValid)return"";const n=x.now().startOf("day"),o=a.startOf("day"),u=o.diff(n,"days").days;return u===0?"Today":u===1?"Tomorrow":u===-1?"Yesterday":a.toFormat("MMM d")},y=(e,a,n)=>{if(!a)return oe(e,n);const o=C(e);if(!o.isValid)return"INVALID";const u=x.now().startOf("day"),N=o.startOf("day"),m=N.diff(u,"days").days;return m===0?"Today":m===1?"Tomorrow":m===-1?"Yesterday":Math.abs(m)<7?o.toRelativeCalendar()||"INVALID":o.toRelative()||"INVALID"},de=e=>{if(!e)return"";try{return k.fromString(e).toText()}catch{return e}},j=e=>e?x.fromISO(e).isValid:!1,ce=({task:e,dateValidation:a})=>{const{onUpdateTask:n,onDeleteTask:o,onEditTask:u,availableCategories:N,onItemClick:m}=ae(),{settings:l}=se(),[f,g]=p.useState(!1),[T,D]=p.useState(e.title),[h,E]=p.useState(!1),A=p.useRef(null),w=p.useRef(null),I=e.status==="done",R=e.status==="cancelled",z=new Date().toISOString().split("T")[0],P=!I&&!R&&e.priority==="high"&&(e.status==="overdue"||e.status==="due"||e.dueAt&&e.dueAt<=z),M={sm:"text-sm",base:"text-base",lg:"text-lg",xl:"text-xl"}[l.fontSize]||"text-sm",$={sm:"mt-0.5",base:"mt-0.5",lg:"mt-1",xl:"mt-1.5"}[l.fontSize]||"mt-0.5",V={sm:"text-[10px]",base:"text-[11px]",lg:"text-xs",xl:"text-sm"}[l.fontSize]||"text-[11px]";p.useEffect(()=>{f&&w.current&&w.current.focus()},[f]);const q=r=>{const i=x.now().toISO(),b={status:r};(r==="doing"||r==="scheduled")&&!e.startAt&&e.status==="todo"&&(b.startAt=i||void 0),r==="done"&&!e.completedAt&&(b.completedAt=i||void 0),r==="cancelled"&&!e.cancelledAt&&(b.cancelledAt=i||void 0),n({...e,...b})},F=()=>{T.trim()?n({...e,title:T}):D(e.title),g(!1)},K=r=>{r.key==="Enter"&&F(),r.key==="Escape"&&(D(e.title),g(!1))},Y=()=>{h?(o(e.id),A.current&&window.clearTimeout(A.current)):(E(!0),A.current=window.setTimeout(()=>{E(!1)},2e3))},_=(r,i)=>i==="done"||i==="cancelled"?"text-emerald-600 bg-emerald-50 border-emerald-200":r?i==="overdue"||r<z?"text-rose-600 bg-rose-50 border-rose-200":r===z?"text-amber-600 bg-amber-50 border-amber-200":"text-emerald-600 bg-emerald-50 border-emerald-200":"text-slate-400",W=r=>{switch(r){case"done":return"bg-emerald-500";case"doing":return"bg-sky-500";case"scheduled":return"bg-blue-500";case"due":return"bg-amber-500";case"overdue":return"bg-rose-500";case"cancelled":return"bg-slate-300";case"unplanned":return"bg-purple-500";default:return"bg-slate-200"}},X=r=>{switch(r){case"done":return"CheckCircle2";case"doing":return"PlayCircle";case"scheduled":return"Clock";case"due":return"AlertCircle";case"overdue":return"AlertTriangle";case"cancelled":return"XCircle";case"unplanned":return"Zap";default:return"Circle"}},Z=r=>{switch(r){case"done":return"text-emerald-500";case"doing":return"text-sky-500";case"scheduled":return"text-blue-500";case"due":return"text-amber-500";case"overdue":return"text-rose-500";case"cancelled":return"text-slate-300";case"unplanned":return"text-purple-500";default:return"text-slate-300 group-hover:text-slate-400"}},U=(r,i=16)=>t.jsx(c,{name:X(r),size:i,className:Z(r),strokeWidth:r==="done"?2.5:2}),G=["todo","doing","scheduled","done","unplanned","due","overdue","cancelled"],J=e.dueAt?L(e.dueAt):null,Q=e.startAt?L(e.startAt):null,S=J||Q,d="flex items-center gap-1.5 px-2 h-5 rounded-full border font-medium leading-none cursor-pointer hover:bg-slate-50 transition-colors select-none text-[length:inherit]";return t.jsxs(B,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,height:0},className:s("group relative flex items-stretch gap-2 pb-1.5 pt-0.5 px-1 transition-all rounded-lg",(I||R)&&"opacity-60",P?"bg-rose-50/60 border border-rose-100 shadow-sm shadow-rose-100/50 hover:bg-rose-100/50":"hover:bg-slate-50 border border-transparent"),children:[t.jsxs("div",{className:s("relative flex flex-col items-center shrink-0 w-6",$),children:[t.jsx("div",{className:s("absolute -top-1 h-6.5 w-px left-1/2 -translate-x-1/2 group-first:hidden","bg-slate-200")}),t.jsx("div",{className:s("absolute top-5 -bottom-1 w-px left-1/2 -translate-x-1/2 group-last:hidden",W(e.status))}),t.jsxs(ne,{children:[t.jsx(le,{asChild:!0,children:t.jsx("button",{className:s("relative z-10 w-6 h-6 flex items-center justify-center transition-transform active:scale-90 outline-none focus:ring-2 focus:ring-slate-200 rounded-full",P?"bg-rose-50 hover:bg-rose-100 shadow-sm":"bg-white hover:bg-slate-50"),title:`Change Status (Current: ${e.status})`,children:U(e.status,18)})}),t.jsx(ie,{side:"bottom",align:"start",sideOffset:5,collisionPadding:10,className:"z-9999 outline-none w-44 p-1.5",children:t.jsx(B,{initial:{opacity:0,scale:.9,y:-5},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-5},transition:{duration:.15},children:t.jsxs("div",{className:"flex flex-col gap-0.5",children:[G.map(r=>t.jsx(H,{asChild:!0,children:t.jsx("button",{onClick:()=>q(r),children:t.jsxs("div",{className:s("w-full flex items-center gap-2.5 px-3 py-2 text-xs font-medium font-mono rounded-lg transition-all hover:bg-slate-300 text-left outline-none","justify-start! text-left!",e.status===r?"bg-slate-200/60 text-slate-900 font-semibold":"text-slate-600 hover:text-slate-900 hover:opacity-80 active:scale-[0.98]"),children:[t.jsx("div",{className:s("shrink-0",e.status===r?"opacity-100":"opacity-70"),children:U(r,14)}),t.jsx("span",{className:"capitalize",children:r})]})})},r)),t.jsx("div",{className:"h-px bg-slate-100 my-1 mx-1"}),t.jsx(H,{asChild:!0,children:t.jsx("button",{onClick:()=>u?.(e),children:t.jsxs("div",{className:"w-full flex items-center justify-start! gap-2 px-3 py-2 text-xs font-medium text-slate-600 hover:text-blue-600 hover:opacity-80 hover:bg-slate-300 transition-all text-left outline-none rounded-lg",children:[t.jsx(c,{name:"Pencil",size:14,className:"opacity-70"}),t.jsx("span",{children:"Edit Details"})]})})})]})})})]})]}),t.jsxs("div",{className:s("flex-1 min-w-0 pt-0.5",S?"pr-16":"pr-8"),children:[t.jsxs("div",{className:"flex items-center gap-2 min-h-5.5 mb-0.5",children:[f?t.jsx("input",{ref:w,value:T,onChange:r=>D(r.target.value),onBlur:F,onKeyDown:K,className:s("flex-1 min-w-0 bg-transparent border-b border-blue-400 focus:outline-none font-medium text-slate-800 pb-0.5",M)}):t.jsx(t.Fragment,{children:t.jsx(O,{onClick:()=>g(!0),className:s("font-medium leading-tight text-slate-800 transition-all cursor-text text-left border-none bg-transparent p-0 appearance-none font-inherit",M,I&&"line-through text-slate-500 decoration-slate-300",R&&"line-through text-slate-400 decoration-slate-300",P&&"text-rose-700 font-semibold"),children:e.title})}),!f&&t.jsx(O,{whileHover:{scale:1.1},onClick:()=>g(!0),className:"opacity-0 group-hover:opacity-100 transition-opacity text-slate-300 hover:text-blue-500 p-1 shrink-0 bg-transparent border-none",children:t.jsx(c,{name:"Pencil",size:12})})]}),t.jsxs("div",{className:s("flex flex-wrap items-center gap-2 font-medium text-slate-500",V),onClick:r=>{m&&r.target===r.currentTarget&&m?.(e)},children:[t.jsx(te,{task:e,onUpdate:n,badgeClass:d}),a&&(a.hasInvalidDates?t.jsxs("div",{className:"flex items-center gap-1.5 px-2 h-5 rounded-full border font-medium leading-none text-rose-600 bg-rose-50 border-rose-200",title:"One or more dates have an invalid format",children:[t.jsx(c,{name:"AlertTriangle",size:10}),t.jsx("span",{className:"text-[10px]",children:"Invalid Date"})]}):a.hasMissingDates?t.jsxs("div",{className:"flex items-center gap-1.5 px-2 h-5 rounded-full border font-medium leading-none text-amber-600 bg-amber-50 border-amber-200",title:"This task has no dates set",children:[t.jsx(c,{name:"AlertCircle",size:10}),t.jsx("span",{className:"text-[10px]",children:"No Dates"})]}):null),e.category&&t.jsx(re,{task:e,onUpdate:n,badgeClass:d,availableCategories:N}),!l.groupingStrategy.includes("createdAt")&&j(e.createdAt)&&t.jsx(v,{type:"createdAt",date:e.createdAt,label:y(e.createdAt,l.useRelativeDates,l.dateFormat),task:e,onUpdate:n,icon:"Plus",className:s(d,"text-slate-500 bg-slate-50 border-slate-200")}),j(e.startAt)&&t.jsx(v,{type:"startAt",date:e.startAt,label:y(e.startAt,l.useRelativeDates,l.dateFormat),icon:"PlayCircle",task:e,onUpdate:n,className:s(d,"text-slate-500 bg-slate-50 border-slate-200")}),j(e.dueAt)&&t.jsx(v,{type:"dueDate",date:e.dueAt,label:`Due: ${y(e.dueAt,l.useRelativeDates,l.dateFormat)}`,icon:"Calendar",task:e,onUpdate:n,className:s(d,_(e.dueAt,e.status))}),j(e.completedAt)&&t.jsx(v,{type:"completedAt",date:e.completedAt,label:`Done: ${y(e.completedAt,l.useRelativeDates,l.dateFormat)}`,icon:"CheckCircle2",task:e,onUpdate:n,className:s(d,"text-emerald-600 bg-emerald-50 border-emerald-200")}),e.isRecurring&&e.recurringInterval&&t.jsxs("div",{className:s(d,"text-slate-500 bg-slate-100 border-slate-200 cursor-default"),title:de(e.recurringInterval),children:[t.jsx(c,{name:"Repeat",size:10}),t.jsx("span",{className:"capitalize",children:"Recurring"})]}),e.tags.map(r=>t.jsx(ee,{tag:r,task:e,onUpdate:n,badgeClass:d},r.id))]}),e.description&&t.jsxs("div",{className:"mt-1 flex items-start gap-1.5 text-slate-400",children:[t.jsx(c,{name:"FileText",size:10,className:"mt-0.5 shrink-0"}),t.jsx("p",{className:s("leading-relaxed line-clamp-2",V),children:e.description})]})]}),S&&t.jsx("div",{className:"absolute right-8 top-3 text-[10px] font-mono font-bold text-slate-400 bg-slate-50 border border-slate-100 px-1.5 py-0.5 rounded-md",children:S}),t.jsx(O,{onClick:Y,className:s("absolute top-2 right-1 p-1.5 rounded-md transition-all",h?"bg-rose-100 text-rose-600 opacity-100":"text-slate-300 opacity-0 group-hover:opacity-100 hover:text-rose-500 hover:bg-slate-100"),whileHover:{scale:1.1},whileTap:{scale:.9},title:h?"Click again to confirm delete":"Delete task",children:t.jsx(c,{name:h?"Trash2":"Trash",size:14})})]})};ce.__docgenInfo={description:"",methods:[],displayName:"TaskItem",props:{task:{required:!0,tsType:{name:"Task"},description:""},dateValidation:{required:!1,tsType:{name:"DateValidationState"},description:""}}};export{ce as T,Ne as f};
