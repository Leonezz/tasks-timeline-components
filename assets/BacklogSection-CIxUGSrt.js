import{j as a}from"./jsx-runtime-u17CrQMm.js";import{r as v}from"./iframe-Cm6QGVzw.js";import{T as A}from"./TaskItem-DFAjBiYp.js";import{I as h}from"./Icon-5YkzlUjT.js";import{a as j}from"./SettingsContext-Dokk4lNj.js";import"./index-BSO_abFL.js";import{D as f}from"./tasks-BV5_RF93.js";import{C as y,a as b,b as I}from"./collapsible-csh1bGvM.js";import{m as g}from"./proxy-XOfmZ1UD.js";import{A as O}from"./index-CIvwPTOI.js";const S=(e,r)=>{const t=["dueAt","startAt","createdAt","completedAt"];let l=!1,i=!1;for(const o of r){const s=e[o];s?f.fromISO(s).isValid||(i=!0):l=!0}for(const o of t){const s=e[o];s&&(f.fromISO(s).isValid||(i=!0))}if(!(!l&&!i))return{hasMissingDates:l,hasInvalidDates:i}},p=e=>{if(!e)return f.invalid("No date");const r=f.fromISO(e);return r.isValid?r:f.invalid("Invalid ISO")},M=e=>{if(e.status==="done"||e.status==="cancelled")return e.status;const r=f.now(),t=r.toISODate()||"",l=r.plus({days:1}).toISODate();if(e.dueAt&&e.dueAt<t)return"overdue";if(e.dueAt&&(e.dueAt===t||e.dueAt===l))return"due";if(e.startAt){const i=f.fromISO(e.startAt);if(i.isValid)return i>r?"scheduled":"doing"}return["due","overdue","scheduled","doing"].includes(e.status)?"todo":e.status},P=(e,r=["dueAt"])=>{const t={},l=["dueAt","startAt","createdAt","completedAt"];return e.forEach(o=>{const s=[];if(r.forEach(d=>{const n=o[d];n&&p(n).isValid&&s.push(n)}),s.length===0)for(const d of l){const n=o[d];if(n&&p(n).isValid){s.push(n);break}}s.forEach(d=>{const n=p(d),{year:c}=n,u=n.toISODate();u&&(t[c]||(t[c]={}),t[c][u]||(t[c][u]=[]),t[c][u].includes(o)||t[c][u].push(o))})}),Object.keys(t).map(Number).sort((o,s)=>s-o).map(o=>{const s=t[o],d=Object.keys(s).sort((m,x)=>x.localeCompare(m)),n=d.map(m=>({date:m,tasks:s[m]})),c=Object.values(s).flat(),u=c.filter(m=>m.status==="done"||m.status==="cancelled").length;return{year:o,dayGroups:n,totalTasks:c.length,completedTasks:u}})},T=({tasks:e})=>{const{settings:r}=j(),[t,l]=v.useState(!0);return a.jsx("div",{className:"mt-8 pt-4 border-t border-slate-100",children:a.jsxs(y,{open:t,onOpenChange:l,children:[a.jsx(b,{asChild:!0,children:a.jsxs("button",{className:"flex items-center gap-2 mb-4 pl-2 w-full group outline-none",children:[a.jsx(g.div,{animate:{rotate:t?90:0},transition:{duration:.2},className:"text-slate-400",children:a.jsx(h,{name:"ChevronRight",size:14})}),a.jsx(h,{name:"Archive",size:14,className:"text-slate-400"}),a.jsx("h3",{className:"text-sm font-bold text-slate-500 uppercase tracking-wider group-hover:text-slate-700 transition-colors",children:"Backlog / Undated"}),a.jsx("span",{className:"text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full font-mono",children:e.length})]})}),a.jsx(O,{initial:!1,children:t&&a.jsx(I,{forceMount:!0,asChild:!0,children:a.jsx(g.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:a.jsx("div",{className:"space-y-0.5",children:e.map(i=>a.jsx(A,{task:i,dateValidation:S(i,r.groupingStrategy)},i.id))})})})})]})})};T.__docgenInfo={description:"",methods:[],displayName:"BacklogSection",props:{tasks:{required:!0,tsType:{name:"Array",elements:[{name:"Task"}],raw:"Task[]"},description:""}}};export{T as B,M as d,P as g};
